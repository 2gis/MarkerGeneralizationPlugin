{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///generalize.min.js","webpack:///webpack/bootstrap 8c767f3aabe717493d4f","webpack:///./src/index.js","webpack:///./src/ExtendedMarker.js","webpack:///./src/MarkerClassList.js","webpack:///./src/Generalize.js","webpack:///./node_modules/@2gis/general/dist/general.js","webpack:///(webpack)/buildin/module.js"],"names":["root","factory","exports","module","define","amd","MarkerGeneralizationPlugin","self","this","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","default","object","property","prototype","hasOwnProperty","p","s","_interopRequireDefault","obj","extendLeaflet","L","markerEx","latlng","options","_ExtendedMarker2","markerGeneralizeGroup","option","_Generalize2","value","_ExtendedMarker","_Generalize","_MarkerClassList","Marker","extend","_extended","onAdd","apply","arguments","_immunityLevel","IMMUNITY","NO_DELETE","_icon","style","display","classes","_addClasses","getEvents","_zoomAnimated","onBeforeRemove","NO_HIDE","initialize","markerClassList","NONE","immunifyForDeletion","immunifyForHide","revokeImmunity","MarkerClassList","marker","_classList","_marker","Util","add","className","DomUtil","addClass","remove","removeClass","contains","clear","toString","keys","join","classList","_general","FeatureGroup","levels","margin","safeZone","size","offset","bufferPart","checkMarkerMinimumLevel","pane","setOptions","_generalizer","General","_layers","_priorityMarkers","_otherMarkers","setMaxZoom","maxZoom","setMinZoom","minZoom","_initZooms","on","getPane","isNaN","_maxZoom","_getMaxZoom","Error","_minZoom","_map","getMaxZoom","_getMinZoom","getMinZoom","_zoomStat","ready","pending","markers","bounds","minX","minY","maxX","maxY","_flushMarkersCache","_getLevels","zoom","ops","_prepareLevels","level","levelId","length","index","degradation","_addLayer","layer","addEventParent","showAlways","push","oldMap","LayerGroup","addLayer","_getMapCenter","centerPoint","_getCenterLayerPoint","projectedPoint","getPixelOrigin","unproject","_getScreenBounds","center","topLeftPoint","_getTopLeftPoint","getSize","x","y","window","devicePixelRatio","_getBounds","screenBounds","_getLatLngBounds","pointBound","pixelBound","Bounds","point","swCoord","getBottomLeft","neCoord","getTopRight","LatLngBounds","_prepareMarker","classForZoom","_prepareMarkersForGeneralization","pixelPosition","project","_latlng","Array","newMarker","groupIndex","iconIndex","_calculateMarkersClassesIfNeeded","getZoom","_calculateMarkersClasses","calculatedBounds","newBounds","newLatLngBounds","_invalidateMarkers","_this","retinaFactor","priorityGroups","map","atlasSpritesEmulation","anchor","pixelDensity","generalize","then","catch","fireEvent","groupClass","markerState","state","removeLayer","_zoomStart","addLayers","layersArray","eachLayer","setTimeout","bind","_removeLayer","beforeLength","indexOf","splice","_this2","zoomstart","zoomend","moveend","getLayers","onRemove","clearLayers","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","_typeof","Symbol","iterator","constructor","e","r","undefined","t","a","u","prevGroupIndex","pixelPositionX","pixelPositionY","NaN","b","worker","queue","currentJob","markerArray","Float32Array","onmessage","resolve","data","dequeue","pixelRatio","sprites","Promise","message","pack","shift","markerCount","postMessage","buffer","oe","console","error","ENTRY_MODULE","replace","match","RegExp","exec","pop","concat","all","JSON","stringify","Blob","type","bare","URL","webkitURL","mozURL","msURL","f","createObjectURL","Worker","objectURL","v","h","g","Uint8Array","w","k","Y","I","X","j","O","P","G","R","A","U","_","J","M","N","q","E","webpackPolyfill","deprecate","paths","children"],"mappings":"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","file":"generalize.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MarkerGeneralizationPlugin\"] = factory();\n\telse\n\t\troot[\"MarkerGeneralizationPlugin\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MarkerGeneralizationPlugin\"] = factory();\n\telse\n\t\troot[\"MarkerGeneralizationPlugin\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/dist/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = extendLeaflet;\n\nvar _ExtendedMarker = __webpack_require__(1);\n\nvar _ExtendedMarker2 = _interopRequireDefault(_ExtendedMarker);\n\nvar _Generalize = __webpack_require__(3);\n\nvar _Generalize2 = _interopRequireDefault(_Generalize);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction extendLeaflet() {\n    L.markerEx = function (latlng, options) {\n        return new _ExtendedMarker2.default(latlng, options);\n    };\n\n    L.markerGeneralizeGroup = function (option) {\n        return new _Generalize2.default(option);\n    };\n} // Какого чОрта? @todo Вытащить в online, тут это не нужно\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _MarkerClassList = __webpack_require__(2);\n\nvar _MarkerClassList2 = _interopRequireDefault(_MarkerClassList);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// eslint-disable-line no-unused-vars\n\n/**\n * Extended marker:\n * - has options to prevent deletion or hide during generalization\n * - makes use of internal class list being applied to icon node\n */\nexports.default = L.Marker.extend({\n    /**\n     * If we can use extended powers of current marker.\n     */\n    _extended: true,\n\n    /**\n     * Augment parent method to apply class names when icon is added on map\n     */\n    onAdd: function onAdd() {\n        L.Marker.prototype.onAdd.apply(this, arguments);\n\n        if (this._immunityLevel == this.IMMUNITY.NO_DELETE) {\n            this._icon.style.display = 'block';\n        }\n\n        this.classes._addClasses();\n    },\n\n    getEvents: function getEvents() {\n        this._zoomAnimated = false;\n        return L.Marker.prototype.getEvents.apply(this, arguments);\n    },\n\n    /**\n     * Determine removal possibility and hide marker if required.\n     * @returns {boolean} If marker should be removed from map\n     */\n    onBeforeRemove: function onBeforeRemove() {\n        if (this._immunityLevel == this.IMMUNITY.NO_HIDE) {\n            return false;\n        }\n\n        if (this._immunityLevel == this.IMMUNITY.NO_DELETE) {\n            this._icon.style.display = 'none';\n            return false;\n        }\n\n        return true;\n    },\n\n    initialize: function initialize() {\n        L.Marker.prototype.initialize.apply(this, arguments);\n        this.classes = L.markerClassList(this);\n    },\n\n    /**\n     * Marker immunity mechanism\n     */\n    IMMUNITY: {\n        NONE: 0, // Simple marker\n        NO_DELETE: 1, // Will stay on map during generalization (DOM node of the icon will not be deleted).\n        NO_HIDE: 2 // Will not be neither deleted nor hidden during generalization.\n    },\n    _immunityLevel: null,\n    immunifyForDeletion: function immunifyForDeletion() {\n        this._immunityLevel = this.IMMUNITY.NO_DELETE;\n        return this;\n    },\n    immunifyForHide: function immunifyForHide() {\n        this._immunityLevel = this.IMMUNITY.NO_HIDE;\n        return this;\n    },\n    revokeImmunity: function revokeImmunity() {\n        this._immunityLevel = this.IMMUNITY.NONE;\n        return this;\n    }\n});\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/**\n * Icon internal classes mechanism\n * Adds possibility to assign css classes to icon even if it is not rendered (yet).\n * Classes will be assigned to icon when it is rendered.\n */\nL.MarkerClassList = function (marker) {\n    this._classList = {};\n    this._marker = marker;\n};\n\nL.Util.extend(L.MarkerClassList.prototype, {\n    add: function add(className) {\n        this._classList[className] = 1;\n        if (this._marker._icon) {\n            L.DomUtil.addClass(this._marker._icon, className);\n        }\n        return this;\n    },\n    remove: function remove(className) {\n        delete this._classList[className];\n        if (this._marker._icon) {\n            L.DomUtil.removeClass(this._marker._icon, className);\n        }\n        return this;\n    },\n    contains: function contains(className) {\n        return !!this._classList[className];\n    },\n    clear: function clear() {\n        if (this._marker._icon) {\n            for (var className in this._classList) {\n                // eslint-disable-line guard-for-in\n                L.DomUtil.removeClass(this._marker._icon, className);\n            }\n        }\n        this._classList = {};\n    },\n    toString: function toString() {\n        if (Object.keys) {\n            return Object.keys(this._classList).join(' ');\n        }\n        var classList = '';\n        for (var i in this._classList) {\n            // eslint-disable-line guard-for-in\n            classList += i + ' ';\n        }\n        return classList;\n    },\n    _addClasses: function _addClasses() {\n        if (!this._marker._icon) {\n            return;\n        }\n        for (var className in this._classList) {\n            // eslint-disable-line guard-for-in\n            L.DomUtil.addClass(this._marker._icon, className);\n        }\n    }\n});\n\nL.markerClassList = function (marker) {\n    return new L.MarkerClassList(marker);\n};\n\nexports.default = L.MarkerClassList;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _general = __webpack_require__(4);\n\nexports.default = L.FeatureGroup.extend({\n    options: {\n        levels: [{\n            margin: 30,\n            safeZone: 20,\n            size: [25, 40],\n            offset: [0.5, 1],\n            className: '_pin'\n        }, {\n            safeZone: 5,\n            size: [6, 6],\n            className: '_bullet'\n        }, {\n            safeZone: 0,\n            className: '_hidden'\n        }],\n\n        bufferPart: 0.5,\n\n        checkMarkerMinimumLevel: function checkMarkerMinimumLevel() {\n            return 0;\n        },\n\n        // by default Layer has overlayPane, but we work with markers\n        pane: 'markerPane'\n    },\n\n    initialize: function initialize(options) {\n        L.Util.setOptions(this, options);\n\n        this._generalizer = new _general.General();\n\n        this._layers = {};\n\n        this._priorityMarkers = [];\n        this._otherMarkers = [];\n\n        this.setMaxZoom(options.maxZoom);\n        this.setMinZoom(options.minZoom);\n\n        this._initZooms(); // Обязательно после set[Min|Max]Zoom\n\n        this.on('invalidationFinish', function () {\n            this.getPane().style.display = 'block';\n        });\n    },\n\n    setMaxZoom: function setMaxZoom(maxZoom) {\n        if (!isNaN(maxZoom) && maxZoom <= 19) {\n            this._maxZoom = maxZoom;\n        }\n    },\n\n    setMinZoom: function setMinZoom(minZoom) {\n        if (!isNaN(minZoom) && minZoom >= 0) {\n            if (minZoom > this._getMaxZoom()) {\n                throw new Error('Min zoom must be smaller than max zoom');\n            }\n            this._minZoom = minZoom;\n        }\n    },\n\n    _getMaxZoom: function _getMaxZoom() {\n        if (!isNaN(this._maxZoom)) {\n            return this._maxZoom;\n        }\n        if (this._map) {\n            return this._map.getMaxZoom();\n        }\n        return 18;\n    },\n\n    _getMinZoom: function _getMinZoom() {\n        if (!isNaN(this._minZoom)) {\n            return this._minZoom;\n        }\n        if (this._map) {\n            return this._map.getMinZoom();\n        }\n        return 0;\n    },\n\n    _initZooms: function _initZooms() {\n        this._zoomStat = {};\n        var maxZoom = this._getMaxZoom();\n        for (var i = this._getMinZoom(); i <= maxZoom; ++i) {\n            this._zoomStat[i] = {\n                ready: false,\n                pending: false,\n                markers: null,\n                bounds: { minX: 0, minY: 0, maxX: 0, maxY: 0 }\n            };\n        }\n    },\n\n    _flushMarkersCache: function _flushMarkersCache() {\n        var maxZoom = this._getMaxZoom();\n        for (var i = this._getMinZoom(); i <= maxZoom; ++i) {\n            this._zoomStat[i].markers = null;\n        }\n    },\n\n\n    _getLevels: function _getLevels(zoom) {\n        var ops = this.options;\n\n        var levels;\n        if (typeof ops.levels === 'function') {\n            levels = ops.levels(this._map, zoom);\n        } else {\n            levels = ops.levels;\n        }\n        return this._prepareLevels(levels);\n    },\n\n    _prepareLevels: function _prepareLevels(levels) {\n        var level = void 0;\n        for (var levelId = 0; levelId < levels.length; levelId++) {\n            level = levels[levelId];\n            level.index = levelId;\n\n            if (!level.size) {\n                level.size = [0, 0];\n            }\n\n            if (!level.offset) {\n                level.offset = [0.5, 0.5];\n            }\n\n            if (!level.margin) {\n                level.margin = 0;\n            }\n\n            if (!level.safeZone) {\n                level.safeZone = 0;\n            }\n\n            if (!level.degradation) {\n                level.degradation = 0;\n            }\n        }\n        return levels;\n    },\n\n    _addLayer: function _addLayer(layer) {\n        layer.addEventParent(this);\n\n        if (layer.showAlways) {\n            this._priorityMarkers.push(layer);\n        } else {\n            this._otherMarkers.push(layer);\n        }\n\n        var oldMap = this._map;\n\n        // Don't allow markers to be added to map: we'll do it during invalidation.\n        if (oldMap) {\n            this._map = null;\n        }\n        L.LayerGroup.prototype.addLayer.call(this, layer);\n        if (oldMap) {\n            this._map = oldMap;\n        }\n    },\n\n    /**\n     * Возвращает географические координаты центра карты на заданном зуме\n     * @param  {Number} zoom\n     * @return {L.LatLng}    Географический центр карты\n     */\n    _getMapCenter: function _getMapCenter(zoom) {\n        var centerPoint = this._map._getCenterLayerPoint();\n        // @TODO getPixelOrigin должен зависить от зума, тут скрыт потенциальный баг\n        var projectedPoint = centerPoint.add(this._map.getPixelOrigin());\n        return this._map.unproject(projectedPoint, zoom);\n    },\n\n\n    /**\n     * Возвращает размеры экрана с учётом devicePixelRatio\n     */\n    _getScreenBounds: function _getScreenBounds(center, zoom) {\n        if (!this._map) {\n            return { minX: 0, minY: 0, maxX: 0, maxY: 0 };\n        }\n        var topLeftPoint = this._map._getTopLeftPoint(center, zoom);\n        var size = this._map.getSize();\n        return {\n            minX: topLeftPoint.x,\n            minY: topLeftPoint.y,\n            maxX: topLeftPoint.x + size.x * window.devicePixelRatio,\n            maxY: topLeftPoint.y + size.y * window.devicePixelRatio\n        };\n    },\n\n\n    /**\n     * Возвращает размеры экрана с учётом devicePixelRatio и некоторого буффера вокруг\n     */\n    _getBounds: function _getBounds(center, zoom) {\n        var screenBounds = this._getScreenBounds(center, zoom);\n        return {\n            minX: screenBounds.minX - (screenBounds.maxX - screenBounds.minX) * this.options.bufferPart,\n            minY: screenBounds.minY - (screenBounds.maxY - screenBounds.minY) * this.options.bufferPart,\n            maxX: screenBounds.maxX + (screenBounds.maxX - screenBounds.minX) * this.options.bufferPart,\n            maxY: screenBounds.maxY + (screenBounds.maxY - screenBounds.minY) * this.options.bufferPart\n        };\n    },\n\n    _getLatLngBounds: function _getLatLngBounds(pointBound, center, zoom) {\n        var pixelBound = new L.Bounds(L.point(pointBound.minX, pointBound.minY), L.point(pointBound.maxX, pointBound.maxY));\n        var swCoord = this._map.unproject(pixelBound.getBottomLeft(), zoom);\n        var neCoord = this._map.unproject(pixelBound.getTopRight(), zoom);\n        return new L.LatLngBounds(swCoord, neCoord);\n    },\n\n    _prepareMarker: function _prepareMarker(layer) {\n        var minZoom = this._getMinZoom();\n        for (var zoom = this._getMaxZoom(); zoom >= minZoom; --zoom) {\n            layer.options.classForZoom = layer.options.classForZoom || [];\n            layer.options.classForZoom[zoom] = 'HIDDEN';\n        }\n    },\n\n    _prepareMarkersForGeneralization: function _prepareMarkersForGeneralization(zoom) {\n        if (this._zoomStat[zoom].markers) {\n            for (var i = 0; i < this._zoomStat[zoom].markers.length; ++i) {\n                var pixelPosition = this._map.project(this._zoomStat[zoom].markers[i]._latlng, zoom);\n                this._zoomStat[zoom].markers[i].pixelPosition = [pixelPosition.x, pixelPosition.y];\n            }\n            return this._zoomStat[zoom].markers;\n        }\n\n        var markers = new Array(this._otherMarkers.length);\n\n        for (var _i = 0; _i < this._otherMarkers.length; ++_i) {\n            var _pixelPosition = this._map.project(this._otherMarkers[_i]._latlng, zoom);\n            var newMarker = {\n                _latlng: this._otherMarkers[_i]._latlng,\n                groupIndex: this.options.checkMarkerMinimumLevel(this._otherMarkers[_i]),\n                iconIndex: -1,\n                pixelPosition: [_pixelPosition.x, _pixelPosition.y]\n            };\n            markers[_i] = newMarker;\n        }\n\n        return markers;\n    },\n\n    _calculateMarkersClassesIfNeeded: function _calculateMarkersClassesIfNeeded() {\n        var zoom = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this._map.getZoom();\n\n        /**\n         * Возможны следующие варианты\n         * 1. Изменился zoom карты\n         * 1.1 Смотрим, для каких границ был произведена генерализация на этом зуме\n         * 1.2 Если попадаем в рамки границ, для которых уже произведена генерализация, то ничего не делаем\n         * 1.3 Если не попадаем - запускаем генерализацию\n         * 2. Изменился центр карты => изменились границы\n         * 2.1 Делаем шаги, аналогичные 1.1 - 1.3.\n         *\n         * Становится очевидно, что генерализацию нужно перезапускать\n         * только когда не попали в ранее посчитанные границы на заданном зуме.\n         */\n        if (!this._map) {\n            return;\n        }\n\n        if (!this._zoomStat[zoom].ready && !this._zoomStat[zoom].pending) {\n            this._calculateMarkersClasses(zoom);\n            return;\n        }\n\n        var center = this._getMapCenter();\n\n        var calculatedBounds = this._zoomStat[zoom].bounds; // Это \"старые\" границы, которые были генерализированы\n        var newBounds = this._getScreenBounds(center, zoom); // Именно размеры экрана без буффера\n        var newLatLngBounds = this._getLatLngBounds( // Это \"новые\" границы, которы должны быть перекрыты \"старыми\"\n        newBounds, center, zoom);\n\n        if (!calculatedBounds.contains(newLatLngBounds)) {\n            // Собственно, описанная выше проверка перекрытия границ\n            this._calculateMarkersClasses(zoom);\n            return;\n        }\n\n        // Если дошли сюда, это значит, что для заданного зума в рамках текущего баунда генерализация уже произведена.\n        this._invalidateMarkers();\n    },\n\n    _calculateMarkersClasses: function _calculateMarkersClasses() {\n        var _this = this;\n\n        var zoom = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this._map.getZoom();\n\n        if (!this._map) {\n            // Если нет карты, то ничего полезного сделать мы не можем\n            return undefined;\n        }\n        var levels = this._getLevels(zoom);\n        var center = this._getMapCenter();\n\n        // Набор конфигов для генерализации маркеров\n        var retinaFactor = window.devicePixelRatio;\n        var bounds = this._getBounds(center, zoom);\n        var priorityGroups = levels.map(function (level) {\n            return {\n                iconIndex: level.index,\n                safeZone: level.safeZone,\n                margin: level.margin,\n                degradation: level.degradation || 0\n            };\n        });\n        var atlasSpritesEmulation = levels.map(function (level) {\n            return {\n                size: level.size, // Размер иконки\n                anchor: level.offset, // Центр иконки относительно ее размеров, принимает занчения от 0 до 1\n                pixelDensity: retinaFactor > 1 ? 2 : 1 // Плотность частиц иконки - 1 или 2\n            };\n        });\n\n        // Переводим маркеры в нужный формат\n        var markers = this._prepareMarkersForGeneralization(zoom);\n\n        this._zoomStat[zoom] = {\n            ready: false,\n            pending: true,\n            bounds: this._getLatLngBounds(bounds, center, zoom),\n            markers: markers\n        };\n\n        // Запускаем генерализацию\n        return this._generalizer.generalize(bounds, retinaFactor, priorityGroups, atlasSpritesEmulation, markers).then(function () {\n            // Выставляем классы для генерализованных маркеров\n            for (var i = 0; i < _this._otherMarkers.length; ++i) {\n                var marker = _this._otherMarkers[i];\n                var iconIndex = markers[i].iconIndex;\n                marker.options.classForZoom[zoom] = iconIndex == -1 ? 'HIDDEN' : levels[iconIndex].className;\n            }\n\n            // Подбиваем маркера, которые не учавстовали в генерализации\n            for (var _i2 = 0; _i2 < _this._priorityMarkers.length; ++_i2) {\n                var _marker = _this._priorityMarkers[_i2];\n                var _iconIndex = _this.options.checkMarkerMinimumLevel(_marker);\n                _marker.options.classForZoom[zoom] = _iconIndex == -1 ? 'HIDDEN' : levels[_iconIndex].className;\n            }\n\n            _this._zoomStat[zoom].ready = true;\n            _this._zoomStat[zoom].pending = false;\n            if (_this._map.getZoom() == zoom) {\n                _this._invalidateMarkers();\n            }\n        }).catch(function () {\n            _this.fireEvent('generalizationError');\n        });\n    },\n\n    _invalidateMarkers: function _invalidateMarkers() {\n        var zoom = this._map.getZoom();\n\n        if (!this._zoomStat[zoom].ready) {\n            return;\n        }\n\n        for (var i in this._layers) {\n            // eslint-disable-line guard-for-in\n            var marker = this._layers[i];\n            var groupClass = marker.options.classForZoom[zoom];\n            var markerState = marker.options.state;\n\n            if (marker._immunityLevel) {\n                if (!marker._map) {\n                    this._map.addLayer(marker);\n                }\n\n                if (markerState != groupClass && groupClass != 'HIDDEN') {\n                    L.DomUtil.addClass(marker._icon, groupClass);\n                }\n            }\n\n            if (groupClass != 'HIDDEN' && markerState != groupClass) {\n                if (!marker._map) {\n                    this._map.addLayer(marker);\n                }\n\n                if (markerState != groupClass) {\n                    if (markerState && markerState != 'HIDDEN') {\n                        L.DomUtil.removeClass(marker._icon, markerState);\n                    }\n                    L.DomUtil.addClass(marker._icon, groupClass);\n                }\n            }\n\n            if (groupClass == 'HIDDEN') {\n                if (!marker.onBeforeRemove || marker.onBeforeRemove && marker.onBeforeRemove()) {\n                    this._map.removeLayer(marker);\n                }\n            }\n            marker.options.state = groupClass;\n        }\n\n        this.fireEvent('invalidationFinish');\n    },\n\n    _zoomStart: function _zoomStart() {\n        this._zoomStat[this._map.getZoom()].markers = null;\n        this.getPane().style.display = 'none';\n    },\n\n    addLayer: function addLayer(layer) {\n        this._addLayer(layer);\n        if (this._map && !layer._immunityLevel) {\n            this._flushMarkersCache();\n            this._prepareMarker(layer);\n            this._calculateMarkersClasses();\n            this._invalidateMarkers();\n        }\n        return this;\n    },\n\n    addLayers: function addLayers(layersArray) {\n        var i;\n        for (i = 0; i < layersArray.length; i++) {\n            this._addLayer(layersArray[i]);\n        }\n\n        if (this._map) {\n            this._flushMarkersCache();\n            this.eachLayer(this._prepareMarker, this);\n            setTimeout(this._calculateMarkersClasses.bind(this), 0);\n        }\n        return this;\n    },\n\n    _removeLayer: function _removeLayer(layer) {\n        var beforeLength = this._layers.length;\n        var index;\n        if ((index = this._priorityMarkers.indexOf(layer)) != -1) {\n            this._priorityMarkers.splice(index, 1);\n        } else if ((index = this._otherMarkers.indexOf(layer)) != -1) {\n            this._otherMarkers.splice(index, 1);\n        }\n        L.LayerGroup.prototype.removeLayer.call(this, layer);\n        return beforeLength - this._layers.length != 0;\n    },\n\n    removeLayer: function removeLayer(layer) {\n        if (this._removeLayer(layer)) {\n            this._calculateMarkersClasses();\n            this._invalidateMarkers();\n        }\n\n        return this;\n    },\n\n    getEvents: function getEvents() {\n        var _this2 = this;\n\n        var events = {\n            zoomstart: this._zoomStart,\n            zoomend: function zoomend() {\n                return _this2._calculateMarkersClassesIfNeeded();\n            },\n            moveend: function moveend() {\n                return _this2._calculateMarkersClassesIfNeeded();\n            }\n        };\n\n        return events;\n    },\n\n    onAdd: function onAdd(map) {\n        this._map = map;\n\n        this._initZooms();\n\n        if (this.getLayers().length) {\n\n            this.eachLayer(this._prepareMarker, this);\n            // wait user map manipulation to know correct init zoom\n            setTimeout(this._calculateMarkersClasses.bind(this), 0);\n        }\n    },\n\n    onRemove: function onRemove(map) {\n        if (!this._map) {\n            return;\n        }\n\n        L.LayerGroup.prototype.onRemove.call(this, map);\n\n        for (var i in this._layers) {\n            // eslint-disable-line guard-for-in\n            var marker = this._layers[i];\n            marker.options.state = 'HIDDEN';\n        }\n\n        this._map = null;\n    },\n\n    clearLayers: function clearLayers() {\n        var i;\n        for (i in this._layers) {\n            // eslint-disable-line guard-for-in\n            this._removeLayer(this._layers[i]);\n        }\n\n        this._priorityMarkers = [];\n        this._otherMarkers = [];\n        return this;\n    }\n});\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(module) {var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n!function (e, r) {\n  \"object\" == ( false ? \"undefined\" : _typeof(exports)) && \"object\" == ( false ? \"undefined\" : _typeof(module)) ? module.exports = r() :  true ? !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (r),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : \"object\" == (typeof exports === \"undefined\" ? \"undefined\" : _typeof(exports)) ? exports.General = r() : e.General = r();\n}(undefined, function () {\n  return function (e) {\n    function r(t) {\n      if (n[t]) return n[t].exports;var o = n[t] = { i: t, l: !1, exports: {} };return e[t].call(o.exports, o, o.exports, r), o.l = !0, o.exports;\n    }var n = {};return r.m = e, r.c = n, r.d = function (e, n, t) {\n      r.o(e, n) || Object.defineProperty(e, n, { configurable: !1, enumerable: !0, get: t });\n    }, r.n = function (e) {\n      var n = e && e.__esModule ? function () {\n        return e.default;\n      } : function () {\n        return e;\n      };return r.d(n, \"a\", n), n;\n    }, r.o = function (e, r) {\n      return Object.prototype.hasOwnProperty.call(e, r);\n    }, r.p = \"/dist/\", r(r.s = 1);\n  }([function (e, r, n) {\n    \"use strict\";\n    function t(e, r) {\n      for (var n = 0, t = 0; n < r.length; n++, t += a) {\n        var o = r[n],\n            u = o.iconIndex,\n            c = o.prevGroupIndex;e[t + i.pixelPositionX] = o.pixelPosition[0], e[t + i.pixelPositionY] = o.pixelPosition[1], e[t + i.groupIndex] = o.groupIndex, e[t + i.iconIndex] = void 0 !== u ? u : NaN, e[t + i.prevGroupIndex] = void 0 !== c ? c : NaN;\n      }\n    }function o(e, r) {\n      for (var n = 0, t = 0; n < e.length; n++, t += a) {\n        var o = r[t + i.iconIndex],\n            u = r[t + i.prevGroupIndex];e[n].iconIndex = o !== o ? void 0 : o, e[n].prevGroupIndex = u !== u ? void 0 : u;\n      }\n    }n.d(r, \"a\", function () {\n      return i;\n    }), n.d(r, \"c\", function () {\n      return a;\n    }), r.b = t, r.d = o;var i = { pixelPositionX: 0, pixelPositionY: 1, groupIndex: 2, iconIndex: 3, prevGroupIndex: 4 },\n        a = Object.keys(i).length;\n  }, function (e, r, n) {\n    \"use strict\";\n    Object.defineProperty(r, \"__esModule\", { value: !0 });var t = n(2);n.d(r, \"General\", function () {\n      return t.a;\n    });\n  }, function (e, r, n) {\n    \"use strict\";\n    n.d(r, \"a\", function () {\n      return a;\n    });var t = n(0),\n        o = n(3),\n        i = n.n(o),\n        a = function () {\n      function e() {\n        var e = this;this.worker = i()(4), this.queue = [], this.currentJob = void 0, this.markerArray = new Float32Array(1e3 * t.c), this.worker.onmessage = function (r) {\n          if (void 0 !== e.currentJob) {\n            var n = e.currentJob,\n                o = n.markers,\n                i = n.resolve;Object(t.d)(o, r.data), e.markerArray = r.data, e.currentJob = void 0, e.dequeue(), i();\n          }\n        };\n      }return e.prototype.generalize = function (e, r, n, t, o) {\n        var i = this,\n            a = { bounds: e, pixelRatio: r, priorityGroups: n, sprites: t };return new Promise(function (e) {\n          i.queue.push({ message: a, markers: o, resolve: e }), i.dequeue();\n        });\n      }, e.prototype.clear = function () {\n        this.queue = [];\n      }, e.prototype.pack = function (e) {\n        e.length * t.c > this.markerArray.length && (this.markerArray = new Float32Array(e.length * t.c)), Object(t.b)(this.markerArray, e);\n      }, e.prototype.dequeue = function () {\n        if (void 0 === this.currentJob) {\n          var e = this.queue.shift();if (void 0 !== e) {\n            this.pack(e.markers);var r = e.message;r.markers = this.markerArray, r.markerCount = e.markers.length, this.worker.postMessage(r, [r.markers.buffer]), this.currentJob = e;\n          }\n        }\n      }, e;\n    }();\n  }, function (e, r, n) {\n    function t(e) {\n      function r(t) {\n        if (n[t]) return n[t].exports;var o = n[t] = { i: t, l: !1, exports: {} };return e[t].call(o.exports, o, o.exports, r), o.l = !0, o.exports;\n      }var n = {};r.m = e, r.c = n, r.i = function (e) {\n        return e;\n      }, r.d = function (e, n, t) {\n        r.o(e, n) || Object.defineProperty(e, n, { configurable: !1, enumerable: !0, get: t });\n      }, r.n = function (e) {\n        var n = e && e.__esModule ? function () {\n          return e.default;\n        } : function () {\n          return e;\n        };return r.d(n, \"a\", n), n;\n      }, r.o = function (e, r) {\n        return Object.prototype.hasOwnProperty.call(e, r);\n      }, r.p = \"/\", r.oe = function (e) {\n        throw console.error(e), e;\n      };var t = r(r.s = ENTRY_MODULE);return t.default || t;\n    }function o(e) {\n      return (e + \"\").replace(/[.?*+^$[\\]\\\\(){}|-]/g, \"\\\\$&\");\n    }function i(e) {\n      var r = [],\n          n = e.toString(),\n          t = n.match(/^function\\s?\\(\\w+,\\s*\\w+,\\s*(\\w+)\\)/);if (!t) return r;for (var i, a = t[1], u = new RegExp(\"(\\\\\\\\n|\\\\W)\" + o(a) + \"\\\\((/\\\\*.*?\\\\*/)?s?.*?([\\\\.|\\\\-|\\\\w|/|@]+).*?\\\\)\", \"g\"); i = u.exec(n);) {\n        r.push(i[3]);\n      }return r;\n    }function a(e, r) {\n      for (var n = [r], t = [], o = {}; n.length;) {\n        var a = n.pop();if (!o[a] && e[a]) {\n          o[a] = !0, t.push(a);var u = i(e[a]);n = n.concat(u);\n        }\n      }return t;\n    }e.exports = function (e, r) {\n      r = r || {};var o = n.m,\n          i = r.all ? Object.keys(o) : a(o, e),\n          u = \"(\" + t.toString().replace(\"ENTRY_MODULE\", JSON.stringify(e)) + \")({\" + i.map(function (e) {\n        return JSON.stringify(e) + \": \" + o[e].toString();\n      }).join(\",\") + \"})(self);\",\n          c = new window.Blob([u], { type: \"text/javascript\" });if (r.bare) return c;var s = window.URL || window.webkitURL || window.mozURL || window.msURL,\n          f = s.createObjectURL(c),\n          p = new window.Worker(f);return p.objectURL = f, p;\n    };\n  }, function (e, r, n) {\n    \"use strict\";\n    Object.defineProperty(r, \"__esModule\", { value: !0 });var t = n(5);r.default = function (e) {\n      e.onmessage = function (r) {\n        var n = r.data;Object(t.a)(n), e.postMessage(n.markers);\n      };\n    };\n  }, function (e, r, n) {\n    \"use strict\";\n    function t(e) {\n      for (var r = e.bounds, n = e.pixelRatio, t = e.priorityGroups, l = e.sprites, m = e.markers, x = e.markerCount, v = 1 + (r.maxX - r.minX >> 3) << 3, h = r.maxY - r.minY, g = v * h + 8 >> 3, y = new Uint8Array(g), b = [], w = 0; w < t.length; w++) {\n        b[w] = new Uint8Array(g);\n      }for (var w = 0; w < x; w++) {\n        var k = w * s.c,\n            Y = m[k + s.a.prevGroupIndex];if (!a(Y)) {\n          var I = m[k + s.a.pixelPositionX] - r.minX,\n              X = m[k + s.a.pixelPositionY] - r.minY,\n              j = t[Y],\n              O = j.iconIndex,\n              P = j.margin,\n              G = j.degradation,\n              R = l[O];if (!R) continue;var A = R.size,\n              U = R.anchor,\n              _ = R.pixelDensity;c(f, v, h, n, A, U, _, I, X, 0), u(f) ? m[k + s.a.iconIndex] = -1 : m[k + s.a.iconIndex] = O, c(p, v, h, n, A, U, _, I, X, P), u(p) || i(y, v, p), c(d, v, h, n, A, U, _, I, X, G), u(d) || i(b[Y], v, d);\n        }\n      }for (var w = 0; w < t.length; w++) {\n        var J = t[w],\n            L = J.safeZone,\n            O = J.iconIndex,\n            P = J.margin,\n            G = J.degradation,\n            R = l[O];if (R) for (var A = R.size, U = R.anchor, _ = R.pixelDensity, M = 0 !== w ? b[w - 1] : void 0, N = w !== t.length - 1 ? b[w] : void 0, q = 0; q < x; q++) {\n          var k = q * s.c,\n              E = m[k + s.a.groupIndex],\n              Y = m[k + s.a.prevGroupIndex],\n              I = m[k + s.a.pixelPositionX] - r.minX,\n              X = m[k + s.a.pixelPositionY] - r.minY;E > w || !a(Y) || (c(p, v, h, n, A, U, _, I, X, P), u(p) || E === w && M && o(M, v, p) || (c(f, v, h, n, A, U, _, I, X, L), u(f) || o(y, v, f) || (c(d, v, h, n, A, U, _, I, X, G), i(y, v, p), N && i(N, v, d), m[k + s.a.iconIndex] = O, m[k + s.a.prevGroupIndex] = w)));\n        }\n      }\n    }function o(e, r, n) {\n      for (var t = n.minX, o = n.minY, i = n.maxX, a = n.maxY, u = o; u < a; u++) {\n        var c = u * r + t >> 3,\n            s = u * r + i >> 3,\n            f = 0;if (c === s) f = e[c] & 255 >> (7 & t) & 255 << 8 - (7 & i);else {\n          f = e[c] & 255 >> (7 & t);for (var p = c + 1; p < s; p++) {\n            f = e[p] | f;\n          }f = e[s] & 255 << 8 - (7 & i) | f;\n        }if (0 !== f) return !0;\n      }return !1;\n    }function i(e, r, n) {\n      for (var t = n.minX, o = n.minY, i = n.maxX, a = n.maxY, u = o; u < a; u++) {\n        var c = u * r + t >> 3,\n            s = u * r + i >> 3;if (c === s) e[c] = e[c] | 255 >> (7 & t) & 255 << 8 - (7 & i);else {\n          e[c] = e[c] | 255 >> (7 & t);for (var f = c + 1; f < s; f++) {\n            e[f] = 255;\n          }e[s] = e[s] | 255 << 8 - (7 & i);\n        }\n      }\n    }function a(e) {\n      return e !== e;\n    }function u(e) {\n      return e.minX === e.maxX || e.minY === e.maxY;\n    }function c(e, r, n, t, o, i, a, u, c, s) {\n      var f = t / a,\n          p = u * t - o[0] * f * i[0] - s | 0,\n          d = c * t - o[1] * f * i[1] - s | 0,\n          l = u * t + o[0] * f * (1 - i[0]) + s | 0,\n          m = c * t + o[1] * f * (1 - i[1]) + s | 0;e.minX = p > 0 ? p < r ? p : r : 0, e.minY = d > 0 ? d < n ? d : n : 0, e.maxX = l > 0 ? l < r ? l : r : 0, e.maxY = m > 0 ? m < n ? m : n : 0;\n    }r.a = t;var s = n(0),\n        f = { minX: 0, minY: 0, maxX: 0, maxY: 0 },\n        p = { minX: 0, minY: 0, maxX: 0, maxY: 0 },\n        d = { minX: 0, minY: 0, maxX: 0, maxY: 0 };\n  }]);\n});\n//# sourceMappingURL=general.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(5)(module)))\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function (module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function () {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function get() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function get() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// generalize.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8c767f3aabe717493d4f","import ExtendedMarker from './ExtendedMarker'; // Какого чОрта? @todo Вытащить в online, тут это не нужно\nimport MarkerGeneralizeGroup from './Generalize';\n\nexport default function extendLeaflet() {\n    L.markerEx = function(latlng, options) {\n        return new ExtendedMarker(latlng, options);\n    };\n\n    L.markerGeneralizeGroup = function(option) {\n        return new MarkerGeneralizeGroup(option);\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import MarkerClassList from './MarkerClassList'; // eslint-disable-line no-unused-vars\n\n/**\n * Extended marker:\n * - has options to prevent deletion or hide during generalization\n * - makes use of internal class list being applied to icon node\n */\nexport default L.Marker.extend({\n    /**\n     * If we can use extended powers of current marker.\n     */\n    _extended: true,\n\n\n    /**\n     * Augment parent method to apply class names when icon is added on map\n     */\n    onAdd: function() {\n        L.Marker.prototype.onAdd.apply(this, arguments);\n\n        if (this._immunityLevel == this.IMMUNITY.NO_DELETE) {\n            this._icon.style.display = 'block';\n        }\n\n        this.classes._addClasses();\n    },\n\n    getEvents: function() {\n        this._zoomAnimated = false;\n        return L.Marker.prototype.getEvents.apply(this, arguments);\n    },\n\n    /**\n     * Determine removal possibility and hide marker if required.\n     * @returns {boolean} If marker should be removed from map\n     */\n    onBeforeRemove: function() {\n        if (this._immunityLevel == this.IMMUNITY.NO_HIDE) {\n            return false;\n        }\n\n        if (this._immunityLevel == this.IMMUNITY.NO_DELETE) {\n            this._icon.style.display = 'none';\n            return false;\n        }\n\n        return true;\n    },\n\n    initialize: function() {\n        L.Marker.prototype.initialize.apply(this, arguments);\n        this.classes = L.markerClassList(this);\n    },\n\n    /**\n     * Marker immunity mechanism\n     */\n    IMMUNITY: {\n        NONE: 0, // Simple marker\n        NO_DELETE: 1, // Will stay on map during generalization (DOM node of the icon will not be deleted).\n        NO_HIDE: 2 // Will not be neither deleted nor hidden during generalization.\n    },\n    _immunityLevel: null,\n    immunifyForDeletion: function() {\n        this._immunityLevel = this.IMMUNITY.NO_DELETE;\n        return this;\n    },\n    immunifyForHide: function() {\n        this._immunityLevel = this.IMMUNITY.NO_HIDE;\n        return this;\n    },\n    revokeImmunity: function() {\n        this._immunityLevel = this.IMMUNITY.NONE;\n        return this;\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/ExtendedMarker.js","/**\n * Icon internal classes mechanism\n * Adds possibility to assign css classes to icon even if it is not rendered (yet).\n * Classes will be assigned to icon when it is rendered.\n */\nL.MarkerClassList = function(marker) {\n    this._classList = {};\n    this._marker = marker;\n};\n\nL.Util.extend(L.MarkerClassList.prototype, {\n    add: function(className) {\n        this._classList[className] = 1;\n        if (this._marker._icon) {\n            L.DomUtil.addClass(this._marker._icon, className);\n        }\n        return this;\n    },\n    remove: function(className) {\n        delete this._classList[className];\n        if (this._marker._icon) {\n            L.DomUtil.removeClass(this._marker._icon, className);\n        }\n        return this;\n    },\n    contains: function(className) {\n        return !!this._classList[className];\n    },\n    clear: function() {\n        if (this._marker._icon) {\n            for (var className in this._classList) { // eslint-disable-line guard-for-in\n                L.DomUtil.removeClass(this._marker._icon, className);\n            }\n        }\n        this._classList = {};\n    },\n    toString: function() {\n        if (Object.keys) {\n            return Object.keys(this._classList).join(' ');\n        }\n        var classList = '';\n        for (var i in this._classList) { // eslint-disable-line guard-for-in\n            classList += i + ' ';\n        }\n        return classList;\n    },\n    _addClasses: function() {\n        if (!this._marker._icon) {\n            return;\n        }\n        for (var className in this._classList) { // eslint-disable-line guard-for-in\n            L.DomUtil.addClass(this._marker._icon, className);\n        }\n    }\n});\n\nL.markerClassList = function(marker) {\n    return new L.MarkerClassList(marker);\n};\n\nexport default L.MarkerClassList;\n\n\n\n// WEBPACK FOOTER //\n// ./src/MarkerClassList.js","import { General } from '@2gis/general';\n\nexport default L.FeatureGroup.extend({\n    options: {\n        levels: [\n            {\n                margin: 30,\n                safeZone: 20,\n                size: [25, 40],\n                offset: [0.5, 1],\n                className: '_pin'\n            },\n            {\n                safeZone: 5,\n                size: [6, 6],\n                className: '_bullet'\n            },\n            {\n                safeZone: 0,\n                className: '_hidden'\n            }\n        ],\n\n        bufferPart: 0.5,\n\n        checkMarkerMinimumLevel: () => 0,\n\n        // by default Layer has overlayPane, but we work with markers\n        pane: 'markerPane'\n    },\n\n    initialize: function(options) {\n        L.Util.setOptions(this, options);\n\n        this._generalizer = new General();\n\n        this._layers = {};\n\n        this._priorityMarkers = [];\n        this._otherMarkers = [];\n\n        this.setMaxZoom(options.maxZoom);\n        this.setMinZoom(options.minZoom);\n\n        this._initZooms(); // Обязательно после set[Min|Max]Zoom\n\n        this.on('invalidationFinish', function() {\n            this.getPane().style.display = 'block';\n        });\n    },\n\n    setMaxZoom: function(maxZoom) {\n        if (!isNaN(maxZoom) && maxZoom <= 19) {\n            this._maxZoom = maxZoom;\n        }\n    },\n\n    setMinZoom: function(minZoom) {\n        if (!isNaN(minZoom) && minZoom >= 0) {\n            if (minZoom > this._getMaxZoom()) {\n                throw new Error('Min zoom must be smaller than max zoom');\n            }\n            this._minZoom = minZoom;\n        }\n    },\n\n    _getMaxZoom: function() {\n        if (!isNaN(this._maxZoom)) {\n            return this._maxZoom;\n        }\n        if (this._map) {\n            return this._map.getMaxZoom();\n        }\n        return 18;\n    },\n\n    _getMinZoom: function() {\n        if (!isNaN(this._minZoom)) {\n            return this._minZoom;\n        }\n        if (this._map) {\n            return this._map.getMinZoom();\n        }\n        return 0;\n    },\n\n    _initZooms: function() {\n        this._zoomStat = {};\n        const maxZoom = this._getMaxZoom();\n        for (let i = this._getMinZoom(); i <= maxZoom; ++i) {\n            this._zoomStat[i] = {\n                ready: false,\n                pending: false,\n                markers: null,\n                bounds: { minX: 0, minY: 0, maxX: 0, maxY: 0 }\n            };\n        }\n    },\n\n    _flushMarkersCache() {\n        const maxZoom = this._getMaxZoom();\n        for (let i = this._getMinZoom(); i <= maxZoom; ++i) {\n            this._zoomStat[i].markers = null;\n        }\n    },\n\n    _getLevels: function(zoom) {\n        var ops = this.options;\n\n        var levels;\n        if (typeof ops.levels === 'function') {\n            levels = ops.levels(this._map, zoom);\n        } else {\n            levels = ops.levels;\n        }\n        return this._prepareLevels(levels);\n    },\n\n    _prepareLevels: function(levels) {\n        let level;\n        for (let levelId = 0; levelId < levels.length; levelId++) {\n            level = levels[levelId];\n            level.index = levelId;\n\n            if (!level.size) {\n                level.size = [0, 0];\n            }\n\n            if (!level.offset) {\n                level.offset = [0.5, 0.5];\n            }\n\n            if (!level.margin) {\n                level.margin = 0;\n            }\n\n            if (!level.safeZone) {\n                level.safeZone = 0;\n            }\n\n            if (!level.degradation) {\n                level.degradation = 0;\n            }\n        }\n        return levels;\n    },\n\n    _addLayer: function(layer) {\n        layer.addEventParent(this);\n\n        if (layer.showAlways) {\n            this._priorityMarkers.push(layer);\n        } else {\n            this._otherMarkers.push(layer);\n        }\n\n        var oldMap = this._map;\n\n        // Don't allow markers to be added to map: we'll do it during invalidation.\n        if (oldMap) {\n            this._map = null;\n        }\n        L.LayerGroup.prototype.addLayer.call(this, layer);\n        if (oldMap) {\n            this._map = oldMap;\n        }\n    },\n\n    /**\n     * Возвращает географические координаты центра карты на заданном зуме\n     * @param  {Number} zoom\n     * @return {L.LatLng}    Географический центр карты\n     */\n    _getMapCenter(zoom) {\n        const centerPoint = this._map._getCenterLayerPoint();\n        // @TODO getPixelOrigin должен зависить от зума, тут скрыт потенциальный баг\n        const projectedPoint = centerPoint.add(this._map.getPixelOrigin());\n        return this._map.unproject(projectedPoint, zoom);\n    },\n\n    /**\n     * Возвращает размеры экрана с учётом devicePixelRatio\n     */\n    _getScreenBounds(center, zoom) {\n        if (!this._map) {\n            return { minX: 0, minY: 0, maxX: 0, maxY: 0 };\n        }\n        const topLeftPoint = this._map._getTopLeftPoint(center, zoom);\n        const size = this._map.getSize();\n        return {\n            minX: topLeftPoint.x,\n            minY: topLeftPoint.y,\n            maxX: topLeftPoint.x + size.x * window.devicePixelRatio,\n            maxY: topLeftPoint.y + size.y * window.devicePixelRatio\n        };\n    },\n\n    /**\n     * Возвращает размеры экрана с учётом devicePixelRatio и некоторого буффера вокруг\n     */\n    _getBounds: function(center, zoom) {\n        const screenBounds = this._getScreenBounds(center, zoom);\n        return {\n            minX: screenBounds.minX - (screenBounds.maxX - screenBounds.minX) * this.options.bufferPart,\n            minY: screenBounds.minY - (screenBounds.maxY - screenBounds.minY) * this.options.bufferPart,\n            maxX: screenBounds.maxX + (screenBounds.maxX - screenBounds.minX) * this.options.bufferPart,\n            maxY: screenBounds.maxY + (screenBounds.maxY - screenBounds.minY) * this.options.bufferPart\n        };\n    },\n\n    _getLatLngBounds: function(pointBound, center, zoom) {\n        const pixelBound = new L.Bounds(\n            L.point(pointBound.minX, pointBound.minY),\n            L.point(pointBound.maxX, pointBound.maxY)\n        );\n        const swCoord = this._map.unproject(pixelBound.getBottomLeft(), zoom);\n        const neCoord = this._map.unproject(pixelBound.getTopRight(), zoom);\n        return new L.LatLngBounds(swCoord, neCoord);\n    },\n\n    _prepareMarker: function(layer) {\n        const minZoom = this._getMinZoom();\n        for (let zoom = this._getMaxZoom(); zoom >= minZoom; --zoom) {\n            layer.options.classForZoom = layer.options.classForZoom || [];\n            layer.options.classForZoom[zoom] = 'HIDDEN';\n        }\n    },\n\n    _prepareMarkersForGeneralization: function(zoom) {\n        if (this._zoomStat[zoom].markers) {\n            for (let i = 0; i < this._zoomStat[zoom].markers.length; ++i) {\n                const pixelPosition = this._map.project(this._zoomStat[zoom].markers[i]._latlng, zoom);\n                this._zoomStat[zoom].markers[i].pixelPosition = [pixelPosition.x, pixelPosition.y];\n            }\n            return this._zoomStat[zoom].markers;\n        }\n\n        const markers = new Array(this._otherMarkers.length);\n\n        for (let i = 0; i < this._otherMarkers.length; ++i) {\n            const pixelPosition = this._map.project(this._otherMarkers[i]._latlng, zoom);\n            const newMarker = {\n                _latlng: this._otherMarkers[i]._latlng,\n                groupIndex: this.options.checkMarkerMinimumLevel(this._otherMarkers[i]),\n                iconIndex: -1,\n                pixelPosition: [pixelPosition.x, pixelPosition.y]\n            };\n            markers[i] = newMarker;\n        }\n\n        return markers;\n    },\n\n    _calculateMarkersClassesIfNeeded: function(zoom = this._map.getZoom()) {\n        /**\n         * Возможны следующие варианты\n         * 1. Изменился zoom карты\n         * 1.1 Смотрим, для каких границ был произведена генерализация на этом зуме\n         * 1.2 Если попадаем в рамки границ, для которых уже произведена генерализация, то ничего не делаем\n         * 1.3 Если не попадаем - запускаем генерализацию\n         * 2. Изменился центр карты => изменились границы\n         * 2.1 Делаем шаги, аналогичные 1.1 - 1.3.\n         *\n         * Становится очевидно, что генерализацию нужно перезапускать\n         * только когда не попали в ранее посчитанные границы на заданном зуме.\n         */\n        if (!this._map) {\n            return;\n        }\n\n        if (!this._zoomStat[zoom].ready && !this._zoomStat[zoom].pending) {\n            this._calculateMarkersClasses(zoom);\n            return;\n        }\n\n        const center = this._getMapCenter();\n\n        const calculatedBounds = this._zoomStat[zoom].bounds; // Это \"старые\" границы, которые были генерализированы\n        const newBounds = this._getScreenBounds(center, zoom); // Именно размеры экрана без буффера\n        const newLatLngBounds = this._getLatLngBounds( // Это \"новые\" границы, которы должны быть перекрыты \"старыми\"\n            newBounds, center, zoom\n        );\n\n        if (!calculatedBounds.contains(newLatLngBounds)) { // Собственно, описанная выше проверка перекрытия границ\n            this._calculateMarkersClasses(zoom);\n            return;\n        }\n\n        // Если дошли сюда, это значит, что для заданного зума в рамках текущего баунда генерализация уже произведена.\n        this._invalidateMarkers();\n    },\n\n    _calculateMarkersClasses: function(zoom = this._map.getZoom()) {\n        if (!this._map) { // Если нет карты, то ничего полезного сделать мы не можем\n            return undefined;\n        }\n        const levels = this._getLevels(zoom);\n        const center = this._getMapCenter();\n\n        // Набор конфигов для генерализации маркеров\n        const retinaFactor = window.devicePixelRatio;\n        const bounds = this._getBounds(center, zoom);\n        const priorityGroups = levels.map((level) => ({\n            iconIndex: level.index,\n            safeZone: level.safeZone,\n            margin: level.margin,\n            degradation: level.degradation || 0\n        }));\n        const atlasSpritesEmulation = levels.map((level) => ({\n            size: level.size, // Размер иконки\n            anchor: level.offset, // Центр иконки относительно ее размеров, принимает занчения от 0 до 1\n            pixelDensity: retinaFactor > 1 ? 2 : 1 // Плотность частиц иконки - 1 или 2\n        }));\n\n        // Переводим маркеры в нужный формат\n        const markers = this._prepareMarkersForGeneralization(zoom);\n\n        this._zoomStat[zoom] = {\n            ready: false,\n            pending: true,\n            bounds: this._getLatLngBounds(bounds, center, zoom),\n            markers: markers\n        };\n\n        // Запускаем генерализацию\n        return this._generalizer.generalize(\n            bounds,\n            retinaFactor,\n            priorityGroups,\n            atlasSpritesEmulation,\n            markers\n        ).then(() => {\n            // Выставляем классы для генерализованных маркеров\n            for (let i = 0; i < this._otherMarkers.length; ++i) {\n                const marker = this._otherMarkers[i];\n                const iconIndex = markers[i].iconIndex;\n                marker.options.classForZoom[zoom] = iconIndex == -1 ? 'HIDDEN' : levels[iconIndex].className;\n            }\n\n            // Подбиваем маркера, которые не учавстовали в генерализации\n            for (let i = 0; i < this._priorityMarkers.length; ++i) {\n                const marker = this._priorityMarkers[i];\n                const iconIndex = this.options.checkMarkerMinimumLevel(marker);\n                marker.options.classForZoom[zoom] = iconIndex == -1 ? 'HIDDEN' : levels[iconIndex].className;\n            }\n\n            this._zoomStat[zoom].ready = true;\n            this._zoomStat[zoom].pending = false;\n            if (this._map.getZoom() == zoom) {\n                this._invalidateMarkers();\n            }\n        }).catch(() => {\n            this.fireEvent('generalizationError');\n        });\n    },\n\n    _invalidateMarkers: function() {\n        const zoom = this._map.getZoom();\n\n        if (!this._zoomStat[zoom].ready) {\n            return;\n        }\n\n        for (let i in this._layers) { // eslint-disable-line guard-for-in\n            const marker = this._layers[i];\n            const groupClass = marker.options.classForZoom[zoom];\n            const markerState = marker.options.state;\n\n            if (marker._immunityLevel) {\n                if (!marker._map) {\n                    this._map.addLayer(marker);\n                }\n\n                if (markerState != groupClass && groupClass != 'HIDDEN') {\n                    L.DomUtil.addClass(marker._icon, groupClass);\n                }\n            }\n\n            if (groupClass != 'HIDDEN' && markerState != groupClass) {\n                if (!marker._map) {\n                    this._map.addLayer(marker);\n                }\n\n                if (markerState != groupClass) {\n                    if (markerState && markerState != 'HIDDEN') {\n                        L.DomUtil.removeClass(marker._icon, markerState);\n                    }\n                    L.DomUtil.addClass(marker._icon, groupClass);\n                }\n            }\n\n            if (groupClass == 'HIDDEN') {\n                if (!marker.onBeforeRemove || (marker.onBeforeRemove && marker.onBeforeRemove())) {\n                    this._map.removeLayer(marker);\n                }\n            }\n            marker.options.state = groupClass;\n        }\n\n        this.fireEvent('invalidationFinish');\n    },\n\n    _zoomStart: function() {\n        this._zoomStat[this._map.getZoom()].markers = null;\n        this.getPane().style.display = 'none';\n    },\n\n    addLayer: function(layer) {\n        this._addLayer(layer);\n        if (this._map && !layer._immunityLevel) {\n            this._flushMarkersCache();\n            this._prepareMarker(layer);\n            this._calculateMarkersClasses();\n            this._invalidateMarkers();\n        }\n        return this;\n    },\n\n    addLayers: function(layersArray) {\n        var i;\n        for (i = 0; i < layersArray.length; i++) {\n            this._addLayer(layersArray[i]);\n        }\n\n        if (this._map) {\n            this._flushMarkersCache();\n            this.eachLayer(this._prepareMarker, this);\n            setTimeout(this._calculateMarkersClasses.bind(this), 0);\n        }\n        return this;\n    },\n\n    _removeLayer: function(layer) {\n        var beforeLength = this._layers.length;\n        var index;\n        if ((index = this._priorityMarkers.indexOf(layer)) != -1) {\n            this._priorityMarkers.splice(index, 1);\n        } else if ((index = this._otherMarkers.indexOf(layer)) != -1) {\n            this._otherMarkers.splice(index, 1);\n        }\n        L.LayerGroup.prototype.removeLayer.call(this, layer);\n        return beforeLength - this._layers.length != 0;\n    },\n\n    removeLayer: function(layer) {\n        if (this._removeLayer(layer)) {\n            this._calculateMarkersClasses();\n            this._invalidateMarkers();\n        }\n\n        return this;\n    },\n\n    getEvents: function() {\n        var events = {\n            zoomstart: this._zoomStart,\n            zoomend: () => this._calculateMarkersClassesIfNeeded(),\n            moveend: () => this._calculateMarkersClassesIfNeeded()\n        };\n\n        return events;\n    },\n\n    onAdd: function(map) {\n        this._map = map;\n\n        this._initZooms();\n\n        if (this.getLayers().length) {\n\n            this.eachLayer(this._prepareMarker, this);\n            // wait user map manipulation to know correct init zoom\n            setTimeout(this._calculateMarkersClasses.bind(this), 0);\n        }\n    },\n\n    onRemove: function(map) {\n        if (!this._map) {\n            return;\n        }\n\n        L.LayerGroup.prototype.onRemove.call(this, map);\n\n        for (let i in this._layers) { // eslint-disable-line guard-for-in\n            const marker = this._layers[i];\n            marker.options.state = 'HIDDEN';\n        }\n\n        this._map = null;\n    },\n\n    clearLayers: function() {\n        var i;\n        for (i in this._layers) { // eslint-disable-line guard-for-in\n            this._removeLayer(this._layers[i]);\n        }\n\n        this._priorityMarkers = [];\n        this._otherMarkers = [];\n        return this;\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/Generalize.js","!function(e,r){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=r():\"function\"==typeof define&&define.amd?define([],r):\"object\"==typeof exports?exports.General=r():e.General=r()}(this,function(){return function(e){function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var n={};return r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,\"a\",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p=\"/dist/\",r(r.s=1)}([function(e,r,n){\"use strict\";function t(e,r){for(var n=0,t=0;n<r.length;n++,t+=a){var o=r[n],u=o.iconIndex,c=o.prevGroupIndex;e[t+i.pixelPositionX]=o.pixelPosition[0],e[t+i.pixelPositionY]=o.pixelPosition[1],e[t+i.groupIndex]=o.groupIndex,e[t+i.iconIndex]=void 0!==u?u:NaN,e[t+i.prevGroupIndex]=void 0!==c?c:NaN}}function o(e,r){for(var n=0,t=0;n<e.length;n++,t+=a){var o=r[t+i.iconIndex],u=r[t+i.prevGroupIndex];e[n].iconIndex=o!==o?void 0:o,e[n].prevGroupIndex=u!==u?void 0:u}}n.d(r,\"a\",function(){return i}),n.d(r,\"c\",function(){return a}),r.b=t,r.d=o;var i={pixelPositionX:0,pixelPositionY:1,groupIndex:2,iconIndex:3,prevGroupIndex:4},a=Object.keys(i).length},function(e,r,n){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var t=n(2);n.d(r,\"General\",function(){return t.a})},function(e,r,n){\"use strict\";n.d(r,\"a\",function(){return a});var t=n(0),o=n(3),i=n.n(o),a=function(){function e(){var e=this;this.worker=i()(4),this.queue=[],this.currentJob=void 0,this.markerArray=new Float32Array(1e3*t.c),this.worker.onmessage=function(r){if(void 0!==e.currentJob){var n=e.currentJob,o=n.markers,i=n.resolve;Object(t.d)(o,r.data),e.markerArray=r.data,e.currentJob=void 0,e.dequeue(),i()}}}return e.prototype.generalize=function(e,r,n,t,o){var i=this,a={bounds:e,pixelRatio:r,priorityGroups:n,sprites:t};return new Promise(function(e){i.queue.push({message:a,markers:o,resolve:e}),i.dequeue()})},e.prototype.clear=function(){this.queue=[]},e.prototype.pack=function(e){e.length*t.c>this.markerArray.length&&(this.markerArray=new Float32Array(e.length*t.c)),Object(t.b)(this.markerArray,e)},e.prototype.dequeue=function(){if(void 0===this.currentJob){var e=this.queue.shift();if(void 0!==e){this.pack(e.markers);var r=e.message;r.markers=this.markerArray,r.markerCount=e.markers.length,this.worker.postMessage(r,[r.markers.buffer]),this.currentJob=e}}},e}()},function(e,r,n){function t(e){function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var n={};r.m=e,r.c=n,r.i=function(e){return e},r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,\"a\",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p=\"/\",r.oe=function(e){throw console.error(e),e};var t=r(r.s=ENTRY_MODULE);return t.default||t}function o(e){return(e+\"\").replace(/[.?*+^$[\\]\\\\(){}|-]/g,\"\\\\$&\")}function i(e){var r=[],n=e.toString(),t=n.match(/^function\\s?\\(\\w+,\\s*\\w+,\\s*(\\w+)\\)/);if(!t)return r;for(var i,a=t[1],u=new RegExp(\"(\\\\\\\\n|\\\\W)\"+o(a)+\"\\\\((/\\\\*.*?\\\\*/)?s?.*?([\\\\.|\\\\-|\\\\w|/|@]+).*?\\\\)\",\"g\");i=u.exec(n);)r.push(i[3]);return r}function a(e,r){for(var n=[r],t=[],o={};n.length;){var a=n.pop();if(!o[a]&&e[a]){o[a]=!0,t.push(a);var u=i(e[a]);n=n.concat(u)}}return t}e.exports=function(e,r){r=r||{};var o=n.m,i=r.all?Object.keys(o):a(o,e),u=\"(\"+t.toString().replace(\"ENTRY_MODULE\",JSON.stringify(e))+\")({\"+i.map(function(e){return JSON.stringify(e)+\": \"+o[e].toString()}).join(\",\")+\"})(self);\",c=new window.Blob([u],{type:\"text/javascript\"});if(r.bare)return c;var s=window.URL||window.webkitURL||window.mozURL||window.msURL,f=s.createObjectURL(c),p=new window.Worker(f);return p.objectURL=f,p}},function(e,r,n){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var t=n(5);r.default=function(e){e.onmessage=function(r){var n=r.data;Object(t.a)(n),e.postMessage(n.markers)}}},function(e,r,n){\"use strict\";function t(e){for(var r=e.bounds,n=e.pixelRatio,t=e.priorityGroups,l=e.sprites,m=e.markers,x=e.markerCount,v=1+(r.maxX-r.minX>>3)<<3,h=r.maxY-r.minY,g=v*h+8>>3,y=new Uint8Array(g),b=[],w=0;w<t.length;w++)b[w]=new Uint8Array(g);for(var w=0;w<x;w++){var k=w*s.c,Y=m[k+s.a.prevGroupIndex];if(!a(Y)){var I=m[k+s.a.pixelPositionX]-r.minX,X=m[k+s.a.pixelPositionY]-r.minY,j=t[Y],O=j.iconIndex,P=j.margin,G=j.degradation,R=l[O];if(!R)continue;var A=R.size,U=R.anchor,_=R.pixelDensity;c(f,v,h,n,A,U,_,I,X,0),u(f)?m[k+s.a.iconIndex]=-1:m[k+s.a.iconIndex]=O,c(p,v,h,n,A,U,_,I,X,P),u(p)||i(y,v,p),c(d,v,h,n,A,U,_,I,X,G),u(d)||i(b[Y],v,d)}}for(var w=0;w<t.length;w++){var J=t[w],L=J.safeZone,O=J.iconIndex,P=J.margin,G=J.degradation,R=l[O];if(R)for(var A=R.size,U=R.anchor,_=R.pixelDensity,M=0!==w?b[w-1]:void 0,N=w!==t.length-1?b[w]:void 0,q=0;q<x;q++){var k=q*s.c,E=m[k+s.a.groupIndex],Y=m[k+s.a.prevGroupIndex],I=m[k+s.a.pixelPositionX]-r.minX,X=m[k+s.a.pixelPositionY]-r.minY;E>w||!a(Y)||(c(p,v,h,n,A,U,_,I,X,P),u(p)||E===w&&M&&o(M,v,p)||(c(f,v,h,n,A,U,_,I,X,L),u(f)||o(y,v,f)||(c(d,v,h,n,A,U,_,I,X,G),i(y,v,p),N&&i(N,v,d),m[k+s.a.iconIndex]=O,m[k+s.a.prevGroupIndex]=w)))}}}function o(e,r,n){for(var t=n.minX,o=n.minY,i=n.maxX,a=n.maxY,u=o;u<a;u++){var c=u*r+t>>3,s=u*r+i>>3,f=0;if(c===s)f=e[c]&255>>(7&t)&255<<8-(7&i);else{f=e[c]&255>>(7&t);for(var p=c+1;p<s;p++)f=e[p]|f;f=e[s]&255<<8-(7&i)|f}if(0!==f)return!0}return!1}function i(e,r,n){for(var t=n.minX,o=n.minY,i=n.maxX,a=n.maxY,u=o;u<a;u++){var c=u*r+t>>3,s=u*r+i>>3;if(c===s)e[c]=e[c]|255>>(7&t)&255<<8-(7&i);else{e[c]=e[c]|255>>(7&t);for(var f=c+1;f<s;f++)e[f]=255;e[s]=e[s]|255<<8-(7&i)}}}function a(e){return e!==e}function u(e){return e.minX===e.maxX||e.minY===e.maxY}function c(e,r,n,t,o,i,a,u,c,s){var f=t/a,p=u*t-o[0]*f*i[0]-s|0,d=c*t-o[1]*f*i[1]-s|0,l=u*t+o[0]*f*(1-i[0])+s|0,m=c*t+o[1]*f*(1-i[1])+s|0;e.minX=p>0?p<r?p:r:0,e.minY=d>0?d<n?d:n:0,e.maxX=l>0?l<r?l:r:0,e.maxY=m>0?m<n?m:n:0}r.a=t;var s=n(0),f={minX:0,minY:0,maxX:0,maxY:0},p={minX:0,minY:0,maxX:0,maxY:0},d={minX:0,minY:0,maxX:0,maxY:0}}])});\n//# sourceMappingURL=general.js.map\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@2gis/general/dist/general.js","module.exports = function(module) {\r\n\tif(!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/module.js"],"sourceRoot":""}