!function(){"use strict";function t(i,e){return this instanceof t?(this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),void this.clear()):new t(i,e)}function i(t,i){t.bbox=e(t,0,t.children.length,i)}function e(t,i,e,n){for(var a,s=o(),h=i;e>h;h++)a=t.children[h],r(s,t.leaf?n(a):a.bbox);return s}function o(){return[1/0,1/0,-(1/0),-(1/0)]}function r(t,i){return t[0]=Math.min(t[0],i[0]),t[1]=Math.min(t[1],i[1]),t[2]=Math.max(t[2],i[2]),t[3]=Math.max(t[3],i[3]),t}function n(t,i){return t.bbox[0]-i.bbox[0]}function a(t,i){return t.bbox[1]-i.bbox[1]}function s(t){return(t[2]-t[0])*(t[3]-t[1])}function h(t){return t[2]-t[0]+(t[3]-t[1])}function l(t,i){return(Math.max(i[2],t[2])-Math.min(i[0],t[0]))*(Math.max(i[3],t[3])-Math.min(i[1],t[1]))}function c(t,i){var e=Math.max(t[0],i[0]),o=Math.max(t[1],i[1]),r=Math.min(t[2],i[2]),n=Math.min(t[3],i[3]);return Math.max(0,r-e)*Math.max(0,n-o)}function u(t,i){return t[0]<=i[0]&&t[1]<=i[1]&&i[2]<=t[2]&&i[3]<=t[3]}function f(t,i){return i[0]<=t[2]&&i[1]<=t[3]&&i[2]>=t[0]&&i[3]>=t[1]}function m(t,i,e,o,r){for(var n,a=[i,e];a.length;)e=a.pop(),i=a.pop(),o>=e-i||(n=i+Math.ceil((e-i)/o/2)*o,_(t,i,e,n,r),a.push(i,n,n,e))}function _(t,i,e,o,r){for(var n,a,s,h,l,c,u,f,m;e>i;){for(e-i>600&&(n=e-i+1,a=o-i+1,s=Math.log(n),h=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*h*(n-h)/n)*(0>a-n/2?-1:1),c=Math.max(i,Math.floor(o-a*h/n+l)),u=Math.min(e,Math.floor(o+(n-a)*h/n+l)),_(t,c,u,o,r)),f=t[o],a=i,m=e,p(t,i,o),r(t[e],f)>0&&p(t,i,e);m>a;){for(p(t,a,m),a++,m--;r(t[a],f)<0;)a++;for(;r(t[m],f)>0;)m--}0===r(t[i],f)?p(t,i,m):(m++,p(t,m,e)),o>=m&&(i=m+1),m>=o&&(e=m-1)}}function p(t,i,e){var o=t[i];t[i]=t[e],t[e]=o}t.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,e=[],o=this.toBBox;if(!f(t,i.bbox))return e;for(var r,n,a,s,h=[];i;){for(r=0,n=i.children.length;n>r;r++)a=i.children[r],s=i.leaf?o(a):a.bbox,f(t,s)&&(i.leaf?e.push(a):u(t,s)?this._all(a,e):h.push(a));i=h.pop()}return e},collides:function(t){var i=this.data,e=this.toBBox;if(!f(t,i.bbox))return!1;for(var o,r,n,a,s=[];i;){for(o=0,r=i.children.length;r>o;o++)if(n=i.children[o],a=i.leaf?e(n):n.bbox,f(t,a)){if(i.leaf||u(t,a))return!0;s.push(n)}i=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,e=t.length;e>i;i++)this.insert(t[i]);return this}var o=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===o.height)this._splitRoot(this.data,o);else{if(this.data.height<o.height){var r=this.data;this.data=o,o=r}this._insert(o,this.data.height-o.height-1,!0)}else this.data=o;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:o(),leaf:!0},this},remove:function(t){if(!t)return this;for(var i,e,o,r,n=this.data,a=this.toBBox(t),s=[],h=[];n||s.length;){if(n||(n=s.pop(),e=s[s.length-1],i=h.pop(),r=!0),n.leaf&&(o=n.children.indexOf(t),-1!==o))return n.children.splice(o,1),s.push(n),this._condense(s),this;r||n.leaf||!u(n.bbox,a)?e?(i++,n=e.children[i],r=!1):n=null:(s.push(n),h.push(i),i=0,e=n,n=n.children[0])}return this},toBBox:function(t){return t},compareMinX:function(t,i){return t[0]-i[0]},compareMinY:function(t,i){return t[1]-i[1]},toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var e=[];t;)t.leaf?i.push.apply(i,t.children):e.push.apply(e,t.children),t=e.pop();return i},_build:function(t,e,o,r){var n,a=o-e+1,s=this._maxEntries;if(s>=a)return n={children:t.slice(e,o+1),height:1,bbox:null,leaf:!0},i(n,this.toBBox),n;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),n={children:[],height:r,bbox:null};var h,l,c,u,f=Math.ceil(a/s),_=f*Math.ceil(Math.sqrt(s));for(m(t,e,o,_,this.compareMinX),h=e;o>=h;h+=_)for(c=Math.min(h+_-1,o),m(t,h,c,f,this.compareMinY),l=h;c>=l;l+=f)u=Math.min(l+f-1,c),n.children.push(this._build(t,l,u,r-1));return i(n,this.toBBox),n},_chooseSubtree:function(t,i,e,o){for(var r,n,a,h,c,u,f,m;;){if(o.push(i),i.leaf||o.length-1===e)break;for(f=m=1/0,r=0,n=i.children.length;n>r;r++)a=i.children[r],c=s(a.bbox),u=l(t,a.bbox)-c,m>u?(m=u,f=f>c?c:f,h=a):u===m&&f>c&&(f=c,h=a);i=h}return i},_insert:function(t,i,e){var o=this.toBBox,n=e?t.bbox:o(t),a=[],s=this._chooseSubtree(n,this.data,i,a);for(s.children.push(t),r(s.bbox,n);i>=0&&a[i].children.length>this._maxEntries;)this._split(a,i),i--;this._adjustParentBBoxes(n,a,i)},_split:function(t,e){var o=t[e],r=o.children.length,n=this._minEntries;this._chooseSplitAxis(o,n,r);var a=this._chooseSplitIndex(o,n,r),s={children:o.children.splice(a,o.children.length-a),height:o.height};o.leaf&&(s.leaf=!0),i(o,this.toBBox),i(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(o,s)},_splitRoot:function(t,e){this.data={children:[t,e],height:t.height+1},i(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,o){var r,n,a,h,l,u,f,m;for(u=f=1/0,r=i;o-i>=r;r++)n=e(t,0,r,this.toBBox),a=e(t,r,o,this.toBBox),h=c(n,a),l=s(n)+s(a),u>h?(u=h,m=r,f=f>l?l:f):h===u&&f>l&&(f=l,m=r);return m},_chooseSplitAxis:function(t,i,e){var o=t.leaf?this.compareMinX:n,r=t.leaf?this.compareMinY:a,s=this._allDistMargin(t,i,e,o),h=this._allDistMargin(t,i,e,r);h>s&&t.children.sort(o)},_allDistMargin:function(t,i,o,n){t.children.sort(n);var a,s,l=this.toBBox,c=e(t,0,i,l),u=e(t,o-i,o,l),f=h(c)+h(u);for(a=i;o-i>a;a++)s=t.children[a],r(c,t.leaf?l(s):s.bbox),f+=h(c);for(a=o-i-1;a>=i;a--)s=t.children[a],r(u,t.leaf?l(s):s.bbox),f+=h(u);return f},_adjustParentBBoxes:function(t,i,e){for(var o=e;o>=0;o--)r(i[o].bbox,t)},_condense:function(t){for(var e,o=t.length-1;o>=0;o--)0===t[o].children.length?o>0?(e=t[o-1].children,e.splice(e.indexOf(t[o]),1)):this.clear():i(t[o],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return [a"+t.join(", a")+"];")}},window.L.Util.rbush=t}(),L.MarkerGeneralizeGroup=L.FeatureGroup.extend({options:{levels:[{margin:30,safeZone:20,size:[25,40],offset:[12.5,40],className:"_pin"},{safeZone:5,size:[6,6],className:"_bullet"},{safeZone:0,className:"_hidden"}],viewportHideOffset:1,checkMarkersIntersection:function(t,i){var e=Math.max(t.safeZone,i.margin);return Math.abs(t.markerX-i.markerX)>e+t.markerWidth/2+i.markerWidth/2||Math.abs(t.markerY-i.markerY)>e+t.markerHeight/2+i.markerHeight/2},checkMarkerMinimumLevel:function(){return 0}},initialize:function(t){L.Util.setOptions(this,t),this._layers={},this._priorityMarkers=[],this._otherMarkers=[],this._calculationBusy=!1,this._calculationQueued=!1,this._zoomReady={},this.setMaxZoom(t.maxZoom),this.setMinZoom(t.minZoom),this.on("invalidationFinish",function(){this._getPane().style.display="block"})},setMaxZoom:function(t){!isNaN(t)&&19>=t&&(this._maxZoom=t)},setMinZoom:function(t){if(!isNaN(t)&&t>=0){if(t>this._getMaxZoom())throw new Error("Min zoom must be smaller than max zoom");this._minZoom=t}},_getMaxZoom:function(){return isNaN(this._maxZoom)?this._map.getMaxZoom():this._maxZoom},_getMinZoom:function(){return isNaN(this._minZoom)?this._map.getMinZoom():this._minZoom},_getLevels:function(t){var i,e=this.options;return i="function"==typeof e.levels?e.levels(this._map,t):e.levels,this._prepareLevels(i)},_prepareLevels:function(t){var i,e,o;for(i=0;i<t.length;i++)for(o=t[i],o.index=i,o.markerOffset=[],o.markerDistance=[],o.size||(o.size=[0,0]),o.offset||(o.offset=[o.size[0]/2,o.size[1]/2]),e=0;2>e;e++)o.markerOffset[e]=o.size[e]/2-o.offset[e];return t},_addLayer:function(t){t._positions={},t.showAlways?this._priorityMarkers.push(t):this._otherMarkers.push(t),L.LayerGroup.prototype.addLayer.call(this,t)},_prepareMarker:function(t){for(var i=this._getMaxZoom(),e=this._getMinZoom();i>=e;i--)this._setMarkerPosition(t,i)},_setMarkerPosition:function(t,i){t._positions[i]=this._map.project(t.getLatLng(),i),t.options.classForZoom=[]},_calculateMarkersClassForEachZoom:function(){var t=this;if(this._calculationBusy)return void(this._calculationQueued=!0);this._calculationBusy=!0,this._zoomReady={};for(var i=this._map.getZoom(),e=this._getMaxZoom(),o=[],r=this._getMinZoom();e>=r;r++)r!=i&&o.push(r);o.sort(function(t,e){return Math.abs(i-t)-Math.abs(i-e)}),this._calculateMarkersClassForZoom(i,function(){L.Util.UnblockingFor(function(i,e){var r=o[i];t._calculateMarkersClassForZoom(r,e)},o.length,function(){t._calculationBusy=!1,t.fireEvent("calculationFinish"),t._calculationQueued&&(t._calculationQueued=!1,t._calculateMarkersClassForEachZoom())})})},_calculateMarkersClassForZoom:function(t,i){function e(t,i){function e(i,e){for(var o=n*i;n*(i+1)>o&&p>o;o++)c.options.checkMarkerMinimumLevel(_[o])<=t?(s=r(_[o],a),f=u.search(s),c._validateGroup(s,f)?(u.insert(s),h[t].push(_[o])):m.push(_[o])):m.push(_[o]);e()}function o(){_=m.slice(),m=[],i()}if(a=l[t],0==l[t].size[0]&&0==l[t].size[1])return h[t]=_.slice(),void i();var n=1e3,p=_.length,d=Math.ceil(p/n);L.Util.UnblockingFor(e,d,o)}function o(){var e,o,r,n,a;for(e=0;e<l.length;e++)for(n=l[e].className,r=l[e],o=0;o<h[e].length;o++)a=h[e][o],a.options.classForZoom[t]=n;c._zoomReady[t]=!0,c._map.getZoom()==t&&c._invalidateMarkers(),i()}function r(i,e){var o=e.safeZone||0,r=e.margin||0,n=Math.max(o,r);i._positions[t]||c._setMarkerPosition(i,t);var a=i._positions[t].x-e.offset[0]-n,s=i._positions[t].y-e.offset[1]-n,h=e.size[0]+2*n,l=e.size[1]+2*n,u=[a,s,a+h,s+l];return u.levelIndex=e.index,u.marker=i,u.safeZone=o,u.margin=r,u.markerX=i._positions[t].x+e.markerOffset[0],u.markerY=i._positions[t].y+e.markerOffset[1],u.markerHeight=e.size[1],u.markerWidth=e.size[0],u}var n,a,s,h={},l=this._getLevels(t),c=this;for(n=0;n<l.length;n++)h[n]=[];var u=L.Util.rbush();for(a=l[0],n=0;n<this._priorityMarkers.length;n++)s=this._prepareMarker(n),h[a].push(s),u.insert(r(s,a));var f,m=[],_=this._otherMarkers.slice();L.Util.UnblockingFor(e,l.length,o)},_getPixelBoundsForZoom:function(t){var i,e=Number.MAX_VALUE,o=Number.MAX_VALUE,r=0,n=0;return this.eachLayer(function(a){a._positions[t]||that._setMarkerPosition(a,t),i=a._positions[t],e=Math.min(e,i.x),o=Math.min(o,i.y),r=Math.max(r,i.x),n=Math.max(n,i.y)}),{x:e,y:o,width:r-e,height:n-o}},_validateGroup:function(t,i){if(0==i.length)return!0;var e,o=this.options;for(e=0;e<i.length;e++)if(!o.checkMarkersIntersection(t,i[e]))return!1;return!0},_invalidateMarkers:function(){var t,i=this._map.getZoom();this._zoomReady[i]&&(this.eachLayer(function(e){t=e.options.classForZoom[i],t&&e.options.state!=t&&(e.options.state&&L.DomUtil.removeClass(e._icon,e.options.state),L.DomUtil.addClass(e._icon,t),e.options.state=t)},this),this.fireEvent("invalidationFinish"))},_hideMarkersOutOfViewPort:function(){var t=this._map.getZoom(),i=this._map.getPixelBounds(),e=(i.max.x-i.min.x)*this.options.viewportHideOffset,o=(i.max.y-i.min.y)*this.options.viewportHideOffset;this.eachLayer(function(r){var n=r._positions[t];r._icon.style.display=n.x>i.min.x-e&&n.x<i.max.x+e&&n.y>i.min.y-o&&n.y<i.max.y+o?"":"none"})},_getPane:function(){return this.options.pane||this._map.getPanes().markerPane},_zoomStart:function(){this._getPane().style.display="none"},_zoomEnd:function(){this._invalidateMarkers(),this._hideMarkersOutOfViewPort()},_moveEnd:function(){this._hideMarkersOutOfViewPort()},addLayer:function(t){return this._addLayer(t),this._map&&(this._prepareMarker(t),this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},addLayers:function(t){var i;for(i=0;i<t.length;i++)this._addLayer(t[i]);return this._map&&(this.eachLayer(this._prepareMarker,this),this._calculateMarkersClassForEachZoom()),this},_removeLayer:function(t){var i=this._layers.length;return L.LayerGroup.prototype.removeLayer.call(this,t),i-this._layers.length!=0},removeLayer:function(t){return this._removeLayer(t)&&(this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},onAdd:function(t){this._map=t,t.on("zoomstart",this._zoomStart,this),t.on("zoomend",this._zoomEnd,this),t.on("moveend",this._moveEnd,this),this.getLayers().length&&(this.eachLayer(this._prepareMarker,this),setTimeout(this._calculateMarkersClassForEachZoom.bind(this),0)),L.LayerGroup.prototype.onAdd.call(this,t)},onRemove:function(t){this._map&&(t.off("zoomstart",this._zoomStart,this),t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),L.LayerGroup.prototype.onRemove.call(this,t),this.eachLayer(function(t){t.options.state=""}),this._map=null)},clearLayers:function(){var t;for(t in this._layers)this._removeLayer(this._layers[t]);return this._priorityMarkers=[],this._otherMarkers=[],this}}),L.markerGeneralizeGroup=function(t){return new L.MarkerGeneralizeGroup(t)},L.Util.UnblockingFor=function(t,i,e){function o(i){setTimeout(function(){t(i,r)},0)}function r(){n++,i>n?o(n):e()}e=e||function(){};var n=0;o(n)};