!function(){"use strict";function t(i,e){return this instanceof t?(this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),void this.clear()):new t(i,e)}function i(t,i){t.bbox=e(t,0,t.children.length,i)}function e(t,i,e,n){for(var a,s=r(),h=i;e>h;h++)a=t.children[h],o(s,t.leaf?n(a):a.bbox);return s}function r(){return[1/0,1/0,-1/0,-1/0]}function o(t,i){return t[0]=Math.min(t[0],i[0]),t[1]=Math.min(t[1],i[1]),t[2]=Math.max(t[2],i[2]),t[3]=Math.max(t[3],i[3]),t}function n(t,i){return t.bbox[0]-i.bbox[0]}function a(t,i){return t.bbox[1]-i.bbox[1]}function s(t){return(t[2]-t[0])*(t[3]-t[1])}function h(t){return t[2]-t[0]+(t[3]-t[1])}function l(t,i){return(Math.max(i[2],t[2])-Math.min(i[0],t[0]))*(Math.max(i[3],t[3])-Math.min(i[1],t[1]))}function c(t,i){var e=Math.max(t[0],i[0]),r=Math.max(t[1],i[1]),o=Math.min(t[2],i[2]),n=Math.min(t[3],i[3]);return Math.max(0,o-e)*Math.max(0,n-r)}function u(t,i){return t[0]<=i[0]&&t[1]<=i[1]&&i[2]<=t[2]&&i[3]<=t[3]}function f(t,i){return i[0]<=t[2]&&i[1]<=t[3]&&i[2]>=t[0]&&i[3]>=t[1]}function m(t,i,e,r,o){for(var n,a=[i,e];a.length;)e=a.pop(),i=a.pop(),r>=e-i||(n=i+Math.ceil((e-i)/r/2)*r,_(t,i,e,n,o),a.push(i,n,n,e))}function _(t,i,e,r,o){for(var n,a,s,h,l,c,u,f,m;e>i;){for(e-i>600&&(n=e-i+1,a=r-i+1,s=Math.log(n),h=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*h*(n-h)/n)*(0>a-n/2?-1:1),c=Math.max(i,Math.floor(r-a*h/n+l)),u=Math.min(e,Math.floor(r+(n-a)*h/n+l)),_(t,c,u,r,o)),f=t[r],a=i,m=e,p(t,i,r),o(t[e],f)>0&&p(t,i,e);m>a;){for(p(t,a,m),a++,m--;o(t[a],f)<0;)a++;for(;o(t[m],f)>0;)m--}0===o(t[i],f)?p(t,i,m):(m++,p(t,m,e)),r>=m&&(i=m+1),m>=r&&(e=m-1)}}function p(t,i,e){var r=t[i];t[i]=t[e],t[e]=r}t.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,e=[],r=this.toBBox;if(!f(t,i.bbox))return e;for(var o,n,a,s,h=[];i;){for(o=0,n=i.children.length;n>o;o++)a=i.children[o],s=i.leaf?r(a):a.bbox,f(t,s)&&(i.leaf?e.push(a):u(t,s)?this._all(a,e):h.push(a));i=h.pop()}return e},collides:function(t){var i=this.data,e=this.toBBox;if(!f(t,i.bbox))return!1;for(var r,o,n,a,s=[];i;){for(r=0,o=i.children.length;o>r;r++)if(n=i.children[r],a=i.leaf?e(n):n.bbox,f(t,a)){if(i.leaf||u(t,a))return!0;s.push(n)}i=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,e=t.length;e>i;i++)this.insert(t[i]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var o=this.data;this.data=r,r=o}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:r(),leaf:!0},this},remove:function(t){if(!t)return this;for(var i,e,r,o,n=this.data,a=this.toBBox(t),s=[],h=[];n||s.length;){if(n||(n=s.pop(),e=s[s.length-1],i=h.pop(),o=!0),n.leaf&&(r=n.children.indexOf(t),-1!==r))return n.children.splice(r,1),s.push(n),this._condense(s),this;o||n.leaf||!u(n.bbox,a)?e?(i++,n=e.children[i],o=!1):n=null:(s.push(n),h.push(i),i=0,e=n,n=n.children[0])}return this},toBBox:function(t){return t},compareMinX:function(t,i){return t[0]-i[0]},compareMinY:function(t,i){return t[1]-i[1]},toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var e=[];t;)t.leaf?i.push.apply(i,t.children):e.push.apply(e,t.children),t=e.pop();return i},_build:function(t,e,r,o){var n,a=r-e+1,s=this._maxEntries;if(s>=a)return n={children:t.slice(e,r+1),height:1,bbox:null,leaf:!0},i(n,this.toBBox),n;o||(o=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,o-1))),n={children:[],height:o,bbox:null};var h,l,c,u,f=Math.ceil(a/s),_=f*Math.ceil(Math.sqrt(s));for(m(t,e,r,_,this.compareMinX),h=e;r>=h;h+=_)for(c=Math.min(h+_-1,r),m(t,h,c,f,this.compareMinY),l=h;c>=l;l+=f)u=Math.min(l+f-1,c),n.children.push(this._build(t,l,u,o-1));return i(n,this.toBBox),n},_chooseSubtree:function(t,i,e,r){for(var o,n,a,h,c,u,f,m;;){if(r.push(i),i.leaf||r.length-1===e)break;for(f=m=1/0,o=0,n=i.children.length;n>o;o++)a=i.children[o],c=s(a.bbox),u=l(t,a.bbox)-c,m>u?(m=u,f=f>c?c:f,h=a):u===m&&f>c&&(f=c,h=a);i=h}return i},_insert:function(t,i,e){var r=this.toBBox,n=e?t.bbox:r(t),a=[],s=this._chooseSubtree(n,this.data,i,a);for(s.children.push(t),o(s.bbox,n);i>=0&&a[i].children.length>this._maxEntries;)this._split(a,i),i--;this._adjustParentBBoxes(n,a,i)},_split:function(t,e){var r=t[e],o=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,o);var a=this._chooseSplitIndex(r,n,o),s={children:r.children.splice(a,r.children.length-a),height:r.height};r.leaf&&(s.leaf=!0),i(r,this.toBBox),i(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(t,e){this.data={children:[t,e],height:t.height+1},i(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,r){var o,n,a,h,l,u,f,m;for(u=f=1/0,o=i;r-i>=o;o++)n=e(t,0,o,this.toBBox),a=e(t,o,r,this.toBBox),h=c(n,a),l=s(n)+s(a),u>h?(u=h,m=o,f=f>l?l:f):h===u&&f>l&&(f=l,m=o);return m},_chooseSplitAxis:function(t,i,e){var r=t.leaf?this.compareMinX:n,o=t.leaf?this.compareMinY:a,s=this._allDistMargin(t,i,e,r),h=this._allDistMargin(t,i,e,o);h>s&&t.children.sort(r)},_allDistMargin:function(t,i,r,n){t.children.sort(n);var a,s,l=this.toBBox,c=e(t,0,i,l),u=e(t,r-i,r,l),f=h(c)+h(u);for(a=i;r-i>a;a++)s=t.children[a],o(c,t.leaf?l(s):s.bbox),f+=h(c);for(a=r-i-1;a>=i;a--)s=t.children[a],o(u,t.leaf?l(s):s.bbox),f+=h(u);return f},_adjustParentBBoxes:function(t,i,e){for(var r=e;r>=0;r--)o(i[r].bbox,t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children,e.splice(e.indexOf(t[r]),1)):this.clear():i(t[r],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return [a"+t.join(", a")+"];")}},window.L.Util.rbush=t}(),L.MarkerGeneralizeGroup=L.FeatureGroup.extend({options:{levels:[{margin:30,safeZone:20,size:[25,40],offset:[12.5,40],className:"_pin"},{safeZone:5,size:[6,6],className:"_bullet"},{safeZone:0,className:"_hidden"}],viewportHideOffset:1,checkMarkersIntersection:function(t,i){var e=Math.max(t.safeZone,i.margin);return Math.abs(t.markerX-i.markerX)>e+t.markerWidth/2+i.markerWidth/2||Math.abs(t.markerY-i.markerY)>e+t.markerHeight/2+i.markerHeight/2},checkMarkerMinimumLevel:function(){return 0}},initialize:function(t){L.Util.setOptions(this,t),this._layers={},this._priorityMarkers=[],this._otherMarkers=[],this._calculationBusy=!1,this._calculationQueued=!1,this._zoomReady={},this.setMaxZoom(t.maxZoom),this.setMinZoom(t.minZoom),this.on("invalidationFinish",function(){this._map.getPanes().markerPane.style.display="block"})},setMaxZoom:function(t){!isNaN(t)&&19>=t&&(this._maxZoom=t)},setMinZoom:function(t){if(!isNaN(t)&&t>=0){if(t>this._getMaxZoom())throw new Error("Min zoom must be smaller than max zoom");this._minZoom=t}},_getMaxZoom:function(){return isNaN(this._maxZoom)?this._map.getMaxZoom():this._maxZoom},_getMinZoom:function(){return isNaN(this._minZoom)?this._map.getMinZoom():this._minZoom},_getLevels:function(t){var i,e=this.options;return i="function"==typeof e.levels?e.levels(this._map,t):e.levels,this._prepareLevels(i)},_prepareLevels:function(t){var i,e,r;for(i=0;i<t.length;i++)for(r=t[i],r.markerOffset=[],r.markerDistance=[],r.size||(r.size=[0,0]),r.offset||(r.offset=[r.size[0]/2,r.size[1]/2]),e=0;2>e;e++)r.markerOffset[e]=r.size[e]/2-r.offset[e];return t},_addLayer:function(t){t._positions={},t.showAlways?this._priorityMarkers.push(t):this._otherMarkers.push(t),L.LayerGroup.prototype.addLayer.call(this,t)},_prepareMarker:function(t){for(var i=this._getMaxZoom(),e=this._getMinZoom();i>=e;i--)this._setMarkerPosition(t,i)},_setMarkerPosition:function(t,i){t._positions[i]=this._map.project(t.getLatLng(),i),t.options.classForZoom=[]},_calculateMarkersClassForEachZoom:function(){var t=this;if(this._calculationBusy)return void(this._calculationQueued=!0);this._calculationBusy=!0,this._zoomReady={};for(var i=this._map.getZoom(),e=this._getMaxZoom(),r=[],o=this._getMinZoom();e>=o;o++)o!=i&&r.push(o);r.sort(function(t,e){return Math.abs(i-t)-Math.abs(i-e)}),this._calculateMarkersClassForZoom(i,function(){L.Util.UnblockingFor(function(i,e){var o=r[i];t._calculateMarkersClassForZoom(o,e)},e-1,function(){t._calculationBusy=!1,t.fireEvent("calculationFinish"),t._calculationQueued&&(t._calculationQueued=!1,t._calculateMarkersClassForEachZoom())})})},_calculateMarkersClassForZoom:function(t,i){function e(t,i){function e(i,e){for(var r=n*i;n*(i+1)>r&&p>r;r++)c.options.checkMarkerMinimumLevel(_[r])<=t?(s=o(_[r],a),f=u.search(s),c._validateGroup(s,f)?(u.insert(s),h[t].push(_[r])):m.push(_[r])):m.push(_[r]);e()}function r(){_=m.slice(),m=[],i()}if(a=l[t],0==l[t].size[0]&&0==l[t].size[1])return h[t]=_.slice(),void i();var n=1e3,p=_.length,d=Math.ceil(p/n);L.Util.UnblockingFor(e,d,r)}function r(){var e,r,o,n,a;for(e=0;e<l.length;e++)for(n=l[e].className,o=l[e],r=0;r<h[e].length;r++)a=h[e][r],a.options.classForZoom[t]=n;c._zoomReady[t]=!0,c._map.getZoom()==t&&c._invalidateMarkers(),i()}function o(i,e){var r=e.safeZone||0,o=e.margin||0,n=Math.max(r,o);i._positions[t]||this._setMarkerPosition(i,t);var a=i._positions[t].x-e.offset[0]-n,s=i._positions[t].y-e.offset[1]-n,h=e.size[0]+2*n,l=e.size[1]+2*n,c=[a,s,a+h,s+l];return c.marker=i,c.safeZone=r,c.margin=o,c.markerX=i._positions[t].x+e.markerOffset[0],c.markerY=i._positions[t].y+e.markerOffset[1],c.markerHeight=e.size[1],c.markerWidth=e.size[0],c}var n,a,s,h={},l=this._getLevels(t),c=this;for(n=0;n<l.length;n++)h[n]=[];var u=L.Util.rbush();for(a=l[0],n=0;n<this._priorityMarkers.length;n++)s=this._prepareMarker(n),h[a].push(s),u.insert(o(s,a));var f,m=[],_=this._otherMarkers.slice();L.Util.UnblockingFor(e,l.length,r)},_getPixelBoundsForZoom:function(t){var i,e=Number.MAX_VALUE,r=Number.MAX_VALUE,o=0,n=0;return this.eachLayer(function(a){a._positions[t]||this._setMarkerPosition(a,t),i=a._positions[t],e=Math.min(e,i.x),r=Math.min(r,i.y),o=Math.max(o,i.x),n=Math.max(n,i.y)}),{x:e,y:r,width:o-e,height:n-r}},_validateGroup:function(t,i){if(0==i.length)return!0;var e,r=this.options;for(e=0;e<i.length;e++)if(!r.checkMarkersIntersection(t,i[e]))return!1;return!0},_invalidateMarkers:function(){var t,i=this._map.getZoom();this._zoomReady[i]&&(this.eachLayer(function(e){t=e.options.classForZoom[i],t&&e.options.state!=t&&(e.options.state&&L.DomUtil.removeClass(e._icon,e.options.state),L.DomUtil.addClass(e._icon,t),e.options.state=t)},this),this.fireEvent("invalidationFinish"))},_hideMarkersOutOfViewPort:function(){var t=this._map.getZoom(),i=this._map.getPixelBounds(),e=(i.max.x-i.min.x)*this.options.viewportHideOffset,r=(i.max.y-i.min.y)*this.options.viewportHideOffset;this.eachLayer(function(o){var n=o._positions[t];o._icon.style.display=n.x>i.min.x-e&&n.x<i.max.x+e&&n.y>i.min.y-r&&n.y<i.max.y+r?"":"none"})},_zoomStart:function(){this._map.getPanes().markerPane.style.display="none"},_zoomEnd:function(){this._invalidateMarkers(),this._hideMarkersOutOfViewPort()},_dragEnd:function(){this._hideMarkersOutOfViewPort()},addLayer:function(t){return this._addLayer(t),this._map&&(this._prepareMarker(t),this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},addLayers:function(t){var i;for(i=0;i<t.length;i++)this._addLayer(t[i]);return this._map&&(this.eachLayer(this._prepareMarker,this),this._calculateMarkersClassForEachZoom()),this},_removeLayer:function(t){var i=this._layers.length;return L.LayerGroup.prototype.removeLayer.call(this,t),i-this._layers.length!=0},removeLayer:function(t){return this._removeLayer(t)&&(this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},onAdd:function(t){this._map=t,t.on("zoomstart",this._zoomStart,this),t.on("zoomend",this._zoomEnd,this),t.on("dragend",this._dragEnd,this),this.eachLayer(this._prepareMarker,this),setTimeout(this._calculateMarkersClassForEachZoom.bind(this),0),L.LayerGroup.prototype.onAdd.call(this,t)},onRemove:function(t){this._map&&(t.off("zoomstart",this._zoomStart,this),t.off("zoomend",this._zoomEnd,this),t.off("dragend",this._dragEnd,this),L.LayerGroup.prototype.onRemove.call(this,t),this.eachLayer(function(t){t.options.state=""}),this._map=null)},clearLayers:function(){var t;for(t in this._layers)this._removeLayer(this._layers[t]);return this._priorityMarkers=[],this._otherMarkers=[],this}}),L.markerGeneralizeGroup=function(t){return new L.MarkerGeneralizeGroup(t)},L.Util.UnblockingFor=function(t,i,e){function r(i){setTimeout(function(){t(i,o)},0)}function o(){n++,i>n?r(n):e()}e=e||function(){};var n=0;r(n)};