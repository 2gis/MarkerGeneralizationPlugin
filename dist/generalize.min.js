!function(){"use strict";function t(i,e){return this instanceof t?(this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),void this.clear()):new t(i,e)}function i(t,i){t.bbox=e(t,0,t.children.length,i)}function e(t,i,e,s){for(var o,a=r(),h=i;h<e;h++)o=t.children[h],n(a,t.leaf?s(o):o.bbox);return a}function r(){return[1/0,1/0,-(1/0),-(1/0)]}function n(t,i){return t[0]=Math.min(t[0],i[0]),t[1]=Math.min(t[1],i[1]),t[2]=Math.max(t[2],i[2]),t[3]=Math.max(t[3],i[3]),t}function s(t,i){return t.bbox[0]-i.bbox[0]}function o(t,i){return t.bbox[1]-i.bbox[1]}function a(t){return(t[2]-t[0])*(t[3]-t[1])}function h(t){return t[2]-t[0]+(t[3]-t[1])}function l(t,i){return(Math.max(i[2],t[2])-Math.min(i[0],t[0]))*(Math.max(i[3],t[3])-Math.min(i[1],t[1]))}function c(t,i){var e=Math.max(t[0],i[0]),r=Math.max(t[1],i[1]),n=Math.min(t[2],i[2]),s=Math.min(t[3],i[3]);return Math.max(0,n-e)*Math.max(0,s-r)}function u(t,i){return t[0]<=i[0]&&t[1]<=i[1]&&i[2]<=t[2]&&i[3]<=t[3]}function f(t,i){return i[0]<=t[2]&&i[1]<=t[3]&&i[2]>=t[0]&&i[3]>=t[1]}function m(t,i,e,r,n){for(var s,o=[i,e];o.length;)e=o.pop(),i=o.pop(),e-i<=r||(s=i+Math.ceil((e-i)/r/2)*r,_(t,i,e,s,n),o.push(i,s,s,e))}function _(t,i,e,r,n){for(var s,o,a,h,l,c,u,f,m;e>i;){for(e-i>600&&(s=e-i+1,o=r-i+1,a=Math.log(s),h=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*h*(s-h)/s)*(o-s/2<0?-1:1),c=Math.max(i,Math.floor(r-o*h/s+l)),u=Math.min(e,Math.floor(r+(s-o)*h/s+l)),_(t,c,u,r,n)),f=t[r],o=i,m=e,p(t,i,r),n(t[e],f)>0&&p(t,i,e);o<m;){for(p(t,o,m),o++,m--;n(t[o],f)<0;)o++;for(;n(t[m],f)>0;)m--}0===n(t[i],f)?p(t,i,m):(m++,p(t,m,e)),m<=r&&(i=m+1),r<=m&&(e=m-1)}}function p(t,i,e){var r=t[i];t[i]=t[e],t[e]=r}t.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,e=[],r=this.toBBox;if(!f(t,i.bbox))return e;for(var n,s,o,a,h=[];i;){for(n=0,s=i.children.length;n<s;n++)o=i.children[n],a=i.leaf?r(o):o.bbox,f(t,a)&&(i.leaf?e.push(o):u(t,a)?this._all(o,e):h.push(o));i=h.pop()}return e},collides:function(t){var i=this.data,e=this.toBBox;if(!f(t,i.bbox))return!1;for(var r,n,s,o,a=[];i;){for(r=0,n=i.children.length;r<n;r++)if(s=i.children[r],o=i.leaf?e(s):s.bbox,f(t,o)){if(i.leaf||u(t,o))return!0;a.push(s)}i=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,e=t.length;i<e;i++)this.insert(t[i]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:r(),leaf:!0},this},remove:function(t){if(!t)return this;for(var i,e,r,n,s=this.data,o=this.toBBox(t),a=[],h=[];s||a.length;){if(s||(s=a.pop(),e=a[a.length-1],i=h.pop(),n=!0),s.leaf&&(r=s.children.indexOf(t),r!==-1))return s.children.splice(r,1),a.push(s),this._condense(a),this;n||s.leaf||!u(s.bbox,o)?e?(i++,s=e.children[i],n=!1):s=null:(a.push(s),h.push(i),i=0,e=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:function(t,i){return t[0]-i[0]},compareMinY:function(t,i){return t[1]-i[1]},toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var e=[];t;)t.leaf?i.push.apply(i,t.children):e.push.apply(e,t.children),t=e.pop();return i},_build:function(t,e,r,n){var s,o=r-e+1,a=this._maxEntries;if(o<=a)return s={children:t.slice(e,r+1),height:1,bbox:null,leaf:!0},i(s,this.toBBox),s;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),s={children:[],height:n,bbox:null};var h,l,c,u,f=Math.ceil(o/a),_=f*Math.ceil(Math.sqrt(a));for(m(t,e,r,_,this.compareMinX),h=e;h<=r;h+=_)for(c=Math.min(h+_-1,r),m(t,h,c,f,this.compareMinY),l=h;l<=c;l+=f)u=Math.min(l+f-1,c),s.children.push(this._build(t,l,u,n-1));return i(s,this.toBBox),s},_chooseSubtree:function(t,i,e,r){for(var n,s,o,h,c,u,f,m;;){if(r.push(i),i.leaf||r.length-1===e)break;for(f=m=1/0,n=0,s=i.children.length;n<s;n++)o=i.children[n],c=a(o.bbox),u=l(t,o.bbox)-c,u<m?(m=u,f=c<f?c:f,h=o):u===m&&c<f&&(f=c,h=o);i=h}return i},_insert:function(t,i,e){var r=this.toBBox,s=e?t.bbox:r(t),o=[],a=this._chooseSubtree(s,this.data,i,o);for(a.children.push(t),n(a.bbox,s);i>=0&&o[i].children.length>this._maxEntries;)this._split(o,i),i--;this._adjustParentBBoxes(s,o,i)},_split:function(t,e){var r=t[e],n=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,n);var o=this._chooseSplitIndex(r,s,n),a={children:r.children.splice(o,r.children.length-o),height:r.height};r.leaf&&(a.leaf=!0),i(r,this.toBBox),i(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(t,e){this.data={children:[t,e],height:t.height+1},i(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,r){var n,s,o,h,l,u,f,m;for(u=f=1/0,n=i;n<=r-i;n++)s=e(t,0,n,this.toBBox),o=e(t,n,r,this.toBBox),h=c(s,o),l=a(s)+a(o),h<u?(u=h,m=n,f=l<f?l:f):h===u&&l<f&&(f=l,m=n);return m},_chooseSplitAxis:function(t,i,e){var r=t.leaf?this.compareMinX:s,n=t.leaf?this.compareMinY:o,a=this._allDistMargin(t,i,e,r),h=this._allDistMargin(t,i,e,n);a<h&&t.children.sort(r)},_allDistMargin:function(t,i,r,s){t.children.sort(s);var o,a,l=this.toBBox,c=e(t,0,i,l),u=e(t,r-i,r,l),f=h(c)+h(u);for(o=i;o<r-i;o++)a=t.children[o],n(c,t.leaf?l(a):a.bbox),f+=h(c);for(o=r-i-1;o>=i;o--)a=t.children[o],n(u,t.leaf?l(a):a.bbox),f+=h(u);return f},_adjustParentBBoxes:function(t,i,e){for(var r=e;r>=0;r--)n(i[r].bbox,t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children,e.splice(e.indexOf(t[r]),1)):this.clear():i(t[r],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return [a"+t.join(", a")+"];")}},window.L.Util.rbush=t}(),L.MarkerClassList=function(t){this._classList={},this._marker=t},L.Util.extend(L.MarkerClassList.prototype,{add:function(t){return this._classList[t]=1,this._marker._icon&&L.DomUtil.addClass(this._marker._icon,t),this},remove:function(t){return delete this._classList[t],this._marker._icon&&L.DomUtil.removeClass(this._marker._icon,t),this},contains:function(t){return!!this._classList[t]},clear:function(){if(this._marker._icon)for(var t in this._classList)L.DomUtil.removeClass(this._marker._icon,t);this._classList={}},toString:function(){if(Object.keys)return Object.keys(this._classList).join(" ");var t="";for(var i in this._classList)t+=i+" "},_addClasses:function(){if(this._marker._icon)for(var t in this._classList)L.DomUtil.addClass(this._marker._icon,t)}}),L.markerClassList=function(t){return new L.MarkerClassList(t)},L.MarkerEx=L.Marker.extend({_extended:!0,onAdd:function(t){L.Marker.prototype.onAdd.apply(this,arguments),this._immunityLevel==this.IMMUNITY.NO_DELETE&&(this._icon.style.display="block"),this.classes._addClasses()},getEvents:function(){return this._zoomAnimated=!1,L.Marker.prototype.getEvents.apply(this,arguments)},onBeforeRemove:function(){return this._immunityLevel!=this.IMMUNITY.NO_HIDE&&(this._immunityLevel!=this.IMMUNITY.NO_DELETE||(this._icon.style.display="none",!1))},initialize:function(){L.Marker.prototype.initialize.apply(this,arguments),this.classes=L.markerClassList(this)},IMMUNITY:{NONE:0,NO_DELETE:1,NO_HIDE:2},_immunityLevel:null,immunifyForDeletion:function(){return this._immunityLevel=this.IMMUNITY.NO_DELETE,this},immunifyForHide:function(){return this._immunityLevel=this.IMMUNITY.NO_HIDE,this},revokeImmunity:function(){return this._immunityLevel=this.IMMUNITY.NONE,this}}),L.markerEx=function(t,i){return new L.MarkerEx(t,i)},L.MarkerGeneralizeGroup=L.FeatureGroup.extend({options:{levels:[{margin:30,safeZone:20,size:[25,40],offset:[12.5,40],className:"_pin"},{safeZone:5,size:[6,6],className:"_bullet"},{safeZone:0,className:"_hidden"}],viewportHideOffset:1,checkMarkersIntersection:function(t,i){var e=Math.max(t.safeZone,i.margin);return Math.abs(t.markerX-i.markerX)>e+t.markerWidth/2+i.markerWidth/2||Math.abs(t.markerY-i.markerY)>e+t.markerHeight/2+i.markerHeight/2},checkMarkerMinimumLevel:function(){return 0},pane:"markerPane"},initialize:function(t){L.Util.setOptions(this,t),this._layers={},this._priorityMarkers=[],this._otherMarkers=[],this._calculationBusy=!1,this._calculationQueued=!1,this._zoomReady={},this.setMaxZoom(t.maxZoom),this.setMinZoom(t.minZoom),this.on("invalidationFinish",function(){this.getPane().style.display="block"})},setMaxZoom:function(t){!isNaN(t)&&t<=19&&(this._maxZoom=t)},setMinZoom:function(t){if(!isNaN(t)&&t>=0){if(t>this._getMaxZoom())throw new Error("Min zoom must be smaller than max zoom");this._minZoom=t}},_getMaxZoom:function(){return isNaN(this._maxZoom)?this._map.getMaxZoom():this._maxZoom},_getMinZoom:function(){return isNaN(this._minZoom)?this._map.getMinZoom():this._minZoom},_getLevels:function(t){var i,e=this.options;return i="function"==typeof e.levels?e.levels(this._map,t):e.levels,this._prepareLevels(i)},_prepareLevels:function(t){var i,e,r;for(i=0;i<t.length;i++)for(r=t[i],r.index=i,r.markerOffset=[],r.markerDistance=[],r.size||(r.size=[0,0]),r.offset||(r.offset=[r.size[0]/2,r.size[1]/2]),e=0;e<2;e++)r.markerOffset[e]=r.size[e]/2-r.offset[e];return t},_addLayer:function(t){t._positions={},t.showAlways?this._priorityMarkers.push(t):this._otherMarkers.push(t);var i=this._map;i&&(this._map=null),L.LayerGroup.prototype.addLayer.call(this,t),i&&(this._map=i)},_prepareMarker:function(t){for(var i=this._getMaxZoom(),e=this._getMinZoom();i>=e;i--)this._setMarkerPosition(t,i)},_setMarkerPosition:function(t,i){t._positions[i]=this._map.project(t.getLatLng(),i),t.options.classForZoom=t.options.classForZoom||[],t.options.classForZoom[i]="HIDDEN"},_calculateMarkersClassForEachZoom:function(){var t=this;if(this._calculationBusy)return void(this._calculationQueued=!0);this._calculationBusy=!0,this._zoomReady={};for(var i=this._map.getZoom(),e=this._getMaxZoom(),r=[],n=this._getMinZoom();n<=e;n++)n!=i&&r.push(n);r.sort(function(t,e){return Math.abs(i-t)-Math.abs(i-e)}),this._calculateMarkersClassForZoom(i,function(){L.Util.UnblockingFor(function(i,e){var n=r[i];t._calculateMarkersClassForZoom(n,e)},r.length,function(){t._calculationBusy=!1,t.fireEvent("calculationFinish"),t._calculationQueued&&(t._calculationQueued=!1,t._calculateMarkersClassForEachZoom())})})},_calculateMarkersClassForZoom:function(t,i){function e(i,e){var n=[],o=m.length;if(0==l[i].size[0]&&0==l[i].size[1])return void e();for(var h=0;h<o;h++){var _=m[h];if(a=r(_,i),c.options.checkMarkerMinimumLevel(_)<=i){var p=s(_,a);f=u.search(p),c._validateGroup(p,f)?(u.insert(p),_.options.classForZoom[t]=a.className):n.push(_)}else n.push(_)}m=n.slice(),e()}function r(t,i){var e=t.options.type;if(!e)return l[i];for(var r=i;r<=l.length;r++){var n=l[r].type;if(!n||n==e)return l[r]}}function n(){c._zoomReady[t]=!0,c._map.getZoom()==t&&c._invalidateMarkers(),i()}function s(i,e){var r=e.safeZone||0,n=e.margin||0,s=Math.max(r,n);i._positions[t]||c._setMarkerPosition(i,t);var o=i._positions[t].x-e.offset[0]-s,a=i._positions[t].y-e.offset[1]-s,h=e.size[0]+2*s,l=e.size[1]+2*s,u=[o,a,o+h,a+l];return u.levelIndex=e.index,u.marker=i,u.safeZone=r,u.margin=n,u.markerX=i._positions[t].x+e.markerOffset[0],u.markerY=i._positions[t].y+e.markerOffset[1],u.markerHeight=e.size[1],u.markerWidth=e.size[0],u}var o,a,h,l=this._getLevels(t),c=this,u=L.Util.rbush();for(o=0;o<this._priorityMarkers.length;o++)h=this._prepareMarker(this._priorityMarkers[o]),a=r(h,0),u.insert(s(h,a));var f,m=[];for(o=0;o<this._otherMarkers.length;o++)h=this._otherMarkers[o],m.push(h);L.Util.UnblockingFor(e,l.length,n)},_getPixelBoundsForZoom:function(t){var i,e=Number.MAX_VALUE,r=Number.MAX_VALUE,n=0,s=0;return this.eachLayer(function(o){o._positions[t]||that._setMarkerPosition(o,t),i=o._positions[t],e=Math.min(e,i.x),r=Math.min(r,i.y),n=Math.max(n,i.x),s=Math.max(s,i.y)}),{x:e,y:r,width:n-e,height:s-r}},_validateGroup:function(t,i){if(0==i.length)return!0;var e,r=this.options;for(e=0;e<i.length;e++)if(!r.checkMarkersIntersection(t,i[e]))return!1;return!0},_invalidateMarkers:function(){var t=this._map.getZoom();if(this._zoomReady[t]){var i=this._map.getPixelBounds(),e=(i.max.x-i.min.x)*this.options.viewportHideOffset,r=(i.max.y-i.min.y)*this.options.viewportHideOffset;i.min._subtract({x:e,y:r}),i.max._add({x:e,y:r}),this.eachLayer(function(e){var r=e.options.classForZoom[t],n=e._positions[t],s=e.options.state;e._immunityLevel&&(e._map||this._map.addLayer(e),s!=r&&"HIDDEN"!=r&&L.DomUtil.addClass(e._icon,r)),i.contains(n)?"HIDDEN"!=r&&s!=r&&(e._map||this._map.addLayer(e),s!=r&&(s&&"HIDDEN"!=s&&L.DomUtil.removeClass(e._icon,s),L.DomUtil.addClass(e._icon,r))):r="HIDDEN","HIDDEN"==r&&(!e.onBeforeRemove||e.onBeforeRemove&&e.onBeforeRemove())&&this._map.removeLayer(e),e.options.state=r},this),this.fireEvent("invalidationFinish")}},_zoomStart:function(){this.getPane().style.display="none"},addLayer:function(t){return this._addLayer(t),this._map&&!t._immunityLevel&&(this._prepareMarker(t),this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},addLayers:function(t){var i;for(i=0;i<t.length;i++)this._addLayer(t[i]);return this._map&&(this.eachLayer(this._prepareMarker,this),setTimeout(this._calculateMarkersClassForEachZoom.bind(this),0)),this},_removeLayer:function(t){var i,e=this._layers.length;return(i=this._priorityMarkers.indexOf(t))!=-1?this._priorityMarkers.splice(i,1):(i=this._otherMarkers.indexOf(t))!=-1&&this._otherMarkers.splice(i,1),L.LayerGroup.prototype.removeLayer.call(this,t),e-this._layers.length!=0},removeLayer:function(t){return this._removeLayer(t)&&(this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},getEvents:function(){var t={zoomstart:this._zoomStart,moveend:this._invalidateMarkers};return t},onAdd:function(t){this._map=t,this.getLayers().length&&(this.eachLayer(this._prepareMarker,this),setTimeout(this._calculateMarkersClassForEachZoom.bind(this),0))},onRemove:function(t){this._map&&(L.LayerGroup.prototype.onRemove.call(this,t),this.eachLayer(function(t){t.options.state="HIDDEN"}),this._map=null)},clearLayers:function(){var t;for(t in this._layers)this._removeLayer(this._layers[t]);return this._priorityMarkers=[],this._otherMarkers=[],this}}),L.markerGeneralizeGroup=function(t){return new L.MarkerGeneralizeGroup(t)},L.Util.UnblockingFor=function(t,i,e){function r(i){setTimeout(function(){t(i,n)},0)}function n(){s++,s<i?r(s):e()}e=e||function(){};var s=0;r(s)};