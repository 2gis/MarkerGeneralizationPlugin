!function(t,e){function i(t,e,i,s){this.max_objects=e||10,this.max_levels=i||4,this.level=s||0,this.bounds=t,this.objects=[],this.nodes=[]}i.prototype.split=function(){var t=this.level+1,s=e.round(this.bounds.width/2),o=e.round(this.bounds.height/2),r=e.round(this.bounds.x),a=e.round(this.bounds.y);this.nodes[0]=new i({x:r+s,y:a,width:s,height:o},this.max_objects,this.max_levels,t),this.nodes[1]=new i({x:r,y:a,width:s,height:o},this.max_objects,this.max_levels,t),this.nodes[2]=new i({x:r,y:a+o,width:s,height:o},this.max_objects,this.max_levels,t),this.nodes[3]=new i({x:r+s,y:a+o,width:s,height:o},this.max_objects,this.max_levels,t)},i.prototype.getIndex=function(t){var e=-1,i=this.bounds.x+this.bounds.width/2,s=this.bounds.y+this.bounds.height/2,o=t.y<s&&t.y+t.height<s,r=t.y>s;return t.x<i&&t.x+t.width<i?o?e=1:r&&(e=2):t.x>i&&(o?e=0:r&&(e=3)),e},i.prototype.insert=function(t){var e,i=0;if("undefined"!=typeof this.nodes[0]&&(e=this.getIndex(t),-1!==e))return void this.nodes[e].insert(t);if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels)for("undefined"==typeof this.nodes[0]&&this.split();i<this.objects.length;)e=this.getIndex(this.objects[i]),-1!==e?this.nodes[e].insert(this.objects.splice(i,1)[0]):i+=1},i.prototype.retrieve=function(t){var e=this.getIndex(t),i=this.objects;if("undefined"!=typeof this.nodes[0])if(-1!==e)i=i.concat(this.nodes[e].retrieve(t));else for(var s=0;s<this.nodes.length;s+=1)i=i.concat(this.nodes[s].retrieve(t));return i},i.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t+=1)"undefined"!=typeof this.nodes[t]&&(this.nodes[t].clear(),delete this.nodes[t])},t.L.Util.Quadtree=i}(window,Math),L.MarkerGeneralizeGroup=L.FeatureGroup.extend({options:{levels:[{margin:30,safeZone:20,size:[25,40],offset:[12.5,40],className:"_pin"},{safeZone:5,size:[6,6],className:"_bullet"},{safeZone:0,className:"_hidden"}],viewportHideOffset:1,checkMarkersIntersection:function(t,e){var i=Math.max(t.safeZone,e.margin);return Math.abs(t.markerX-e.markerX)>i+t.markerWidth/2+e.markerWidth/2||Math.abs(t.markerY-e.markerY)>i+t.markerHeight/2+e.markerHeight/2},checkMarkerMinimumLevel:function(){return 0}},initialize:function(t){L.Util.setOptions(this,t),this._layers={},this._priorityMarkers=[],this._otherMarkers=[],this._calculationBusy=!1,this._calculationQueued=!1,this._zoomReady={},this.on("invalidationFinish",function(){this._map.getPanes().markerPane.style.display="block"})},_getLevels:function(t){var e,i=this.options;return e="function"==typeof i.levels?i.levels(this._map,t):i.levels,this._prepareLevels(e)},_prepareLevels:function(t){var e,i,s;for(e=0;e<t.length;e++)for(s=t[e],s.markerOffset=[],s.markerDistance=[],s.size||(s.size=[0,0]),s.offset||(s.offset=[s.size[0]/2,s.size[1]/2]),i=0;2>i;i++)s.markerOffset[i]=s.size[i]/2-s.offset[i];return t},_addLayer:function(t){t._positions={},t.showAlways?this._priorityMarkers.push(t):this._otherMarkers.push(t),L.LayerGroup.prototype.addLayer.call(this,t)},_prepareMarker:function(t){for(var e,i=this._maxZoom;i>=0;i--)e=this._map.project(t.getLatLng(),i),t._positions[i]=e,t.options.classForZoom=[]},_calculateMarkersClassForEachZoom:function(){var t=this;if(this._calculationBusy)return void(this._calculationQueued=!0);this._calculationBusy=!0,this._zoomReady={},this._maxZoom=this._map.getMaxZoom();for(var e=this._map.getZoom(),i=t._map.getMaxZoom(),s=[],o=1;i>=o;o++)o!=e&&s.push(o);s.sort(function(t,i){return Math.abs(e-t)-Math.abs(e-i)}),this._calculateMarkersClassForZoom(e,function(){L.Util.UnblockingFor(function(e,i){var o=s[e];t._calculateMarkersClassForZoom(o,i)},i-1,function(){t._calculationBusy=!1,t._calculationQueued&&(t._calculationQueued=!1,t._calculateMarkersClassForEachZoom())})})},_calculateMarkersClassForZoom:function(t,e){function i(t,e){function i(e,i){for(var s=r*e;r*(e+1)>s&&u>s;s++)c.options.checkMarkerMinimumLevel(_[s])<=t?(n=o(_[s],a),d=m.retrieve(n),c._validateGroup(n,d)?(m.insert(n),h[t].push(_[s])):f.push(_[s])):f.push(_[s]);i()}function s(){_=f.slice(),f=[],e()}if(a=l[t],0==l[t].size[0]&&0==l[t].size[1])return h[t]=_.slice(),void e();var r=200,u=_.length,p=Math.ceil(u/r);L.Util.UnblockingFor(i,p,s)}function s(){var i,s,o,r,a;for(i=0;i<l.length;i++)for(r=l[i].className,o=l[i],s=0;s<h[i].length;s++)a=h[i][s],a.options.classForZoom[t]=r;c._zoomReady[t]=!0,c._map.getZoom()==t&&c._invalidateMarkers(),e()}function o(e,i){var s=i.safeZone||0,o=i.margin||0,r=Math.max(s,o);return{marker:e,safeZone:s,margin:o,x:e._positions[t].x-i.offset[0]-r,y:e._positions[t].y-i.offset[1]-r,height:i.size[1]+2*r,width:i.size[0]+2*r,markerX:e._positions[t].x+i.markerOffset[0],markerY:e._positions[t].y+i.markerOffset[1],markerHeight:i.size[1],markerWidth:i.size[0]}}var r,a,n,h={},l=this._getLevels(t),c=(this.options,this),u=this._getPixelBoundsForZoom(t);for(r=0;r<l.length;r++)h[r]=[];var m=new L.Util.Quadtree(u);for(a=l[0],r=0;r<this._priorityMarkers.length;r++)n=this._prepareMarker(r),h[a].push(n),m.insert(o(n,a));var d,f=[],_=this._otherMarkers.slice();L.Util.UnblockingFor(i,l.length,s)},_getPixelBoundsForZoom:function(t){var e,i=Number.MAX_VALUE,s=Number.MAX_VALUE,o=0,r=0;return this.eachLayer(function(a){e=a._positions[t],i=Math.min(i,e.x),s=Math.min(s,e.y),o=Math.max(o,e.x),r=Math.max(r,e.y)}),{x:i,y:s,width:o-i,height:r-s}},_validateGroup:function(t,e){if(0==e.length)return!0;var i,s=this.options;for(i=0;i<e.length;i++)if(!s.checkMarkersIntersection(t,e[i]))return!1;return!0},_invalidateMarkers:function(){var t,e=this._map.getZoom();this._zoomReady[e]&&(this.eachLayer(function(i){t=i.options.classForZoom[e],t&&i.options.state!=t&&(i.options.state&&L.DomUtil.removeClass(i._icon,i.options.state),L.DomUtil.addClass(i._icon,t),i.options.state=t)},this),this.fireEvent("invalidationFinish"))},_hideMarkersOutOfViewPort:function(){var t=this._map.getZoom(),e=this._map.getPixelBounds(),i=(e.max.x-e.min.x)*this.options.viewportHideOffset,s=(e.max.y-e.min.y)*this.options.viewportHideOffset;this.eachLayer(function(o){var r=o._positions[t];o._icon.style.display=r.x>e.min.x-i&&r.x<e.max.x+i&&r.y>e.min.y-s&&r.y<e.max.y+s?"":"none"})},_zoomStart:function(){this._map.getPanes().markerPane.style.display="none"},_zoomEnd:function(){this._invalidateMarkers(),this._hideMarkersOutOfViewPort()},_dragEnd:function(){this._hideMarkersOutOfViewPort()},addLayer:function(t){return this._addLayer(t),this._map&&(this._prepareMarker(t),this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},addLayers:function(t){var e;for(e=0;e<t.length;e++)this._addLayer(t[e]);return this._map&&(this.eachLayer(this._prepareMarker,this),this._calculateMarkersClassForEachZoom()),this},_removeLayer:function(t){var e=this._layers.length;return L.LayerGroup.prototype.removeLayer.call(this,t),e-this._layers.length!=0},removeLayer:function(t){return this._removeLayer(t)&&(this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},onAdd:function(t){this._map=t,this._maxZoom=this._map.getMaxZoom(),t.on("zoomstart",this._zoomStart,this),t.on("zoomend",this._zoomEnd,this),t.on("dragend",this._dragEnd,this),this.eachLayer(this._prepareMarker,this),this._calculateMarkersClassForEachZoom(),L.LayerGroup.prototype.onAdd.call(this,t)},onRemove:function(t){this._map&&(t.off("zoomstart",this._zoomStart,this),t.off("zoomend",this._zoomEnd,this),t.off("dragend",this._dragEnd,this),L.LayerGroup.prototype.onRemove.call(this,t),this.eachLayer(function(t){t.options.state=""}),this._map=null)},clearLayers:function(){var t;for(t in this._layers)this._removeLayer(this._layers[t]);return this._priorityMarkers=[],this._otherMarkers=[],this}}),L.markerGeneralizeGroup=function(t){return new L.MarkerGeneralizeGroup(t)},L.Util.UnblockingFor=function(t,e,i){function s(e){setTimeout(function(){t(e,o)},0)}function o(){r++,e>r?s(r):i()}i=i||function(){};var r=0;s(r)};