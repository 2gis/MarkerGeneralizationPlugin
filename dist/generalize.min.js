!function(t,e){function s(t,e,s,i){this.max_objects=e||10,this.max_levels=s||4,this.level=i||0,this.bounds=t,this.objects=[],this.nodes=[]}s.prototype.split=function(){var t=this.level+1,i=e.round(this.bounds.width/2),r=e.round(this.bounds.height/2),o=e.round(this.bounds.x),a=e.round(this.bounds.y);this.nodes[0]=new s({x:o+i,y:a,width:i,height:r},this.max_objects,this.max_levels,t),this.nodes[1]=new s({x:o,y:a,width:i,height:r},this.max_objects,this.max_levels,t),this.nodes[2]=new s({x:o,y:a+r,width:i,height:r},this.max_objects,this.max_levels,t),this.nodes[3]=new s({x:o+i,y:a+r,width:i,height:r},this.max_objects,this.max_levels,t)},s.prototype.getIndex=function(t){var e=-1,s=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,r=t.y<i&&t.y+t.height<i,o=t.y>i;return t.x<s&&t.x+t.width<s?r?e=1:o&&(e=2):t.x>s&&(r?e=0:o&&(e=3)),e},s.prototype.insert=function(t){var e,s=0;if("undefined"!=typeof this.nodes[0]&&(e=this.getIndex(t),-1!==e))return void this.nodes[e].insert(t);if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels)for("undefined"==typeof this.nodes[0]&&this.split();s<this.objects.length;)e=this.getIndex(this.objects[s]),-1!==e?this.nodes[e].insert(this.objects.splice(s,1)[0]):s+=1},s.prototype.retrieve=function(t){var e=this.getIndex(t),s=this.objects;if("undefined"!=typeof this.nodes[0])if(-1!==e)s=s.concat(this.nodes[e].retrieve(t));else for(var i=0;i<this.nodes.length;i+=1)s=s.concat(this.nodes[i].retrieve(t));return s},s.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t+=1)"undefined"!=typeof this.nodes[t]&&(this.nodes[t].clear(),delete this.nodes[t])},t.L.Util.Quadtree=s}(window,Math),L.MarkerGeneralizeGroup=L.FeatureGroup.extend({options:{levels:[{margin:30,safeZone:20,size:[25,40],offset:[12.5,40],className:"_pin"},{safeZone:5,size:[6,6],className:"_bullet"},{safeZone:0,className:"_hidden"}],checkMarkersIntersection:function(t,e){var s=Math.max(t.safeZone,e.margin);return Math.abs(t.markerX-e.markerX)>s+t.markerWidth/2+e.markerWidth/2||Math.abs(t.markerY-e.markerY)>s+t.markerHeight/2+e.markerHeight/2},checkMarkerMinimumLevel:function(){return 0}},initialize:function(t){L.Util.setOptions(this,t),this._layers={},this._markers={},this._priorityMarkers=[],this._otherMarkers=[],this._calculationBusy=!1,this._calculationQueued=!1,this._zoomReady={},this.on("invalidationFinish",function(){this._map.getPanes().markerPane.style.display="block"})},_getLevels:function(t){var e,s=this.options;return e="function"==typeof s.levels?s.levels(this._map,t):s.levels,this._prepareLevels(e)},_prepareLevels:function(t){var e,s,i;for(e=0;e<t.length;e++)for(i=t[e],i.markerOffset=[],i.markerDistance=[],i.size||(i.size=[0,0]),i.offset||(i.offset=[i.size[0]/2,i.size[1]/2]),s=0;2>s;s++)i.markerOffset[s]=i.size[s]/2-i.offset[s];return t},_addLayer:function(t){t._positions={},t.showAlways?this._priorityMarkers.push(t):this._otherMarkers.push(t),L.LayerGroup.prototype.addLayer.call(this,t)},_prepareMarker:function(t){for(var e,s=this._maxZoom;s>=0;s--)e=this._map.project(t.getLatLng(),s),t._positions[s]=e,t.options.classForZoom=[]},_calculateMarkersClassForEachZoom:function(){var t=this;if(this._calculationBusy)return void(this._calculationQueued=!0);this._calculationBusy=!0,this._zoomReady={},this._maxZoom=this._map.getMaxZoom();for(var e=this._map.getZoom(),s=t._map.getMaxZoom(),i=[],r=1;s>=r;r++)r!=e&&i.push(r);i.sort(function(t,s){return Math.abs(e-t)-Math.abs(e-s)}),this._calculateMarkersClassForZoom(e,function(){L.Util.UnblockingFor(function(e,s){var r=i[e];t._calculateMarkersClassForZoom(r,s)},s-1,function(){t._calculationBusy=!1,t._calculationQueued&&(t._calculationQueued=!1,t._calculateMarkersClassForEachZoom())})})},_calculateMarkersClassForZoom:function(t,e){function s(t,e){function s(e,s){for(var i=o*e;o*(e+1)>i&&c>i;i++)l.options.checkMarkerMinimumLevel(d[i])<=t?(n=r(d[i],a),m=u.retrieve(n),l._validateGroup(n,m)?(u.insert(n),l._markers[t].push(d[i])):_.push(d[i])):_.push(d[i]);s()}function i(){d=_.slice(),_=[],e()}if(a=h[t],0==h[t].size[0]&&0==h[t].size[1])return l._markers[t]=d.slice(),void e();var o=200,c=d.length,f=Math.ceil(c/o);L.Util.UnblockingFor(s,f,i)}function i(){var s,i,r,o,a;for(s=0;s<h.length;s++)for(o=h[s].className,r=h[s],i=0;i<l._markers[s].length;i++)a=l._markers[s][i],a.options.classForZoom[t]=o;l._zoomReady[t]=!0,l._map.getZoom()==t&&l._invalidateMarkers(),e()}function r(e,s){var i=s.safeZone||0,r=s.margin||0,o=Math.max(i,r);return{marker:e,safeZone:i,margin:r,x:e._positions[t].x-s.offset[0]-o,y:e._positions[t].y-s.offset[1]-o,height:s.size[1]+2*o,width:s.size[0]+2*o,markerX:e._positions[t].x+s.markerOffset[0],markerY:e._positions[t].y+s.markerOffset[1],markerHeight:s.size[1],markerWidth:s.size[0]}}var o,a,n,h=this._getLevels(t),l=(this.options,this),c=this._getPixelBoundsForZoom(t);for(o=0;o<h.length;o++)this._markers[o]=[];var u=new L.Util.Quadtree(c);for(a=h[0],o=0;o<this._priorityMarkers.length;o++)n=this._prepareMarker(o),this._markers[a].push(n),u.insert(r(n,a));var m,_=[],d=this._otherMarkers.slice();L.Util.UnblockingFor(s,h.length,i)},_getPixelBoundsForZoom:function(t){var e,s=Number.MAX_VALUE,i=Number.MAX_VALUE,r=0,o=0;return this.eachLayer(function(a){e=a._positions[t],s=Math.min(s,e.x),i=Math.min(i,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y)}),{x:s,y:i,width:r-s,height:o-i}},_validateGroup:function(t,e){if(0==e.length)return!0;var s,i=this.options;for(s=0;s<e.length;s++)if(!i.checkMarkersIntersection(t,e[s]))return!1;return!0},_invalidateMarkers:function(){var t,e=this._map.getZoom();this._zoomReady[e]&&(this.eachLayer(function(s){t=s.options.classForZoom[e],t&&s.options.state!=t&&(s.options.state&&L.DomUtil.removeClass(s._icon,s.options.state),L.DomUtil.addClass(s._icon,t),s.options.state=t)},this),this.fireEvent("invalidationFinish"))},_hideMarkersOutOfViewPort:function(){var t=this._map.getZoom(),e=this._map.getPixelBounds(),s=e.max.x-e.min.x,i=e.max.y-e.min.y;this.eachLayer(function(r){var o=r._positions[t];r._icon.style.display=o.x>e.min.x-s&&o.x<e.max.x+s&&o.y>e.min.y-i&&o.y<e.max.y+i?"":"none"})},_zoomStart:function(){this._map.getPanes().markerPane.style.display="none"},_zoomEnd:function(){this._invalidateMarkers(),this._hideMarkersOutOfViewPort()},_dragEnd:function(){this._hideMarkersOutOfViewPort()},addLayer:function(t){return this._addLayer(t),this._map&&(this._prepareMarker(t),this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},addLayers:function(t){var e;for(e=0;e<t.length;e++)this._addLayer(t[e]);return this._map&&(this.eachLayer(this._prepareMarker,this),this._calculateMarkersClassForEachZoom()),this},_removeLayer:function(t){var e=this._layers.length;return L.LayerGroup.prototype.removeLayer.call(this,t),e-this._layers.length!=0},removeLayer:function(t){return this._removeLayer(t)&&(this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},onAdd:function(t){this._map=t,this._maxZoom=this._map.getMaxZoom(),t.on("zoomstart",this._zoomStart,this),t.on("zoomend",this._zoomEnd,this),t.on("dragend",this._dragEnd,this),this.eachLayer(this._prepareMarker,this),this._calculateMarkersClassForEachZoom(),L.LayerGroup.prototype.onAdd.call(this,t)},onRemove:function(t){this._map&&(t.off("zoomstart",this._zoomStart,this),t.off("zoomend",this._zoomEnd,this),t.off("dragend",this._dragEnd,this),L.LayerGroup.prototype.onRemove.call(this,t),this.eachLayer(function(t){t.options.state=""}),this._map=null)},clearLayers:function(){var t;for(t in this._layers)this._removeLayer(this._layers[t]);return this._markers={},this._priorityMarkers=[],this._otherMarkers=[],this}}),L.markerGeneralizeGroup=function(t){return new L.MarkerGeneralizeGroup(t)},L.Util.UnblockingFor=function(t,e,s){function i(e){setTimeout(function(){t(e,r)},0)}function r(){o++,e>o?i(o):s()}s=s||function(){};var o=0;i(o)};