!function(t,e){function s(t,e,s,i){this.max_objects=e||10,this.max_levels=s||4,this.level=i||0,this.bounds=t,this.objects=[],this.nodes=[]}s.prototype.split=function(){var t=this.level+1,i=e.round(this.bounds.width/2),o=e.round(this.bounds.height/2),r=e.round(this.bounds.x),a=e.round(this.bounds.y);this.nodes[0]=new s({x:r+i,y:a,width:i,height:o},this.max_objects,this.max_levels,t),this.nodes[1]=new s({x:r,y:a,width:i,height:o},this.max_objects,this.max_levels,t),this.nodes[2]=new s({x:r,y:a+o,width:i,height:o},this.max_objects,this.max_levels,t),this.nodes[3]=new s({x:r+i,y:a+o,width:i,height:o},this.max_objects,this.max_levels,t)},s.prototype.getIndex=function(t){var e=-1,s=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,o=t.y<i&&t.y+t.height<i,r=t.y>i;return t.x<s&&t.x+t.width<s?o?e=1:r&&(e=2):t.x>s&&(o?e=0:r&&(e=3)),e},s.prototype.insert=function(t){var e,s=0;if("undefined"!=typeof this.nodes[0]&&(e=this.getIndex(t),-1!==e))return void this.nodes[e].insert(t);if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels)for("undefined"==typeof this.nodes[0]&&this.split();s<this.objects.length;)e=this.getIndex(this.objects[s]),-1!==e?this.nodes[e].insert(this.objects.splice(s,1)[0]):s+=1},s.prototype.retrieve=function(t){var e=this.getIndex(t),s=this.objects;if("undefined"!=typeof this.nodes[0])if(-1!==e)s=s.concat(this.nodes[e].retrieve(t));else for(var i=0;i<this.nodes.length;i+=1)s=s.concat(this.nodes[i].retrieve(t));return s},s.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t+=1)"undefined"!=typeof this.nodes[t]&&(this.nodes[t].clear(),delete this.nodes[t])},t.L.Util.Quadtree=s}(window,Math),L.MarkerGeneralizeGroup=L.FeatureGroup.extend({options:{levels:[{safeZone:20,size:[25,40],offset:[12.5,40],className:"_pin"},{safeZone:5,size:[6,6],className:"_bullet"},{safeZone:0,className:"_hidden"}],checkMarkersIntersection:function(t,e){var s=Math.min(t.safeZone,e.safeZone);return Math.abs(t.x-e.x)>s+t.width/2+e.width/2||Math.abs(t.y-e.y)>s+t.height/2+e.height/2},checkMarkerMinimumLevel:function(){return 0}},initialize:function(t){L.Util.setOptions(this,t),this._layers={},this._markers={},this._priorityMarkers=[],this._otherMarkers=[],this._calculationBusy=!1,this._calculationQueued=!1;for(var e=0;e<this.options.levels.length;e++)this._markers[e]=[];var s,i,o;for(s=0;s<this.options.levels.length;s++)for(o=this.options.levels[s],o.markerOffset=[],o.markerDistance=[],o.size||(o.size=[0,0]),o.offset||(o.offset=[o.size[0]/2,o.size[1]/2]),i=0;2>i;i++)o.markerOffset[i]=o.size[i]/2-o.offset[i]},_addLayer:function(t){t._positions={},t.showAlways?this._priorityMarkers.push(t):this._otherMarkers.push(t),L.LayerGroup.prototype.addLayer.call(this,t)},_prepareMarker:function(t){for(var e,s=this._maxZoom;s>=0;s--)e=this._map.project(t.getLatLng(),s),t._positions[s]=e,t.options.classForZoom=[]},_calculateMarkersClassForEachZoom:function(){var t=this;if(this._calculationBusy)return void(this._calculationQueued=!0);this._calculationBusy=!0,this._maxZoom=this._map.getMaxZoom();for(var e=this._map.getZoom(),s=t._map.getMaxZoom(),i=[],o=1;s>=o;o++)o!=e&&i.push(o);i.sort(function(t,s){return Math.abs(e-t)-Math.abs(e-s)}),this._calculateMarkersClassForZoom(e,function(){L.Util.UnblockingFor(function(e,s){var o=i[e];t._calculateMarkersClassForZoom(o,s)},s-1,function(){t._calculationBusy=!1,t._calculationQueued&&(t._calculationQueued=!1,t._calculateMarkersClassForEachZoom())})})},_calculateMarkersClassForZoom:function(t,e){function s(t,e){function s(e,s){for(var i=r*e;r*(e+1)>i&&c>i;i++)l.options.checkMarkerMinimumLevel(f[i])<=t?(n=o(f[i],a),_=u.retrieve(n),l._validateGroup(n,_)?(u.insert(n),l._markers[t].push(f[i])):m.push(f[i])):m.push(f[i]);s()}function i(){f=m.slice(),m=[],e()}if(a=h.levels[t],0==h.levels[t].size[0]&&0==h.levels[t].size[1])return l._markers[t]=f.slice(),void e();var r=200,c=f.length,d=Math.ceil(c/r);L.Util.UnblockingFor(s,d,i)}function i(){var s,i,o,r,a;for(s=0;s<l.options.levels.length;s++)for(r=l.options.levels[s].className,o=l.options.levels[s],i=0;i<l._markers[s].length;i++)a=l._markers[s][i],a.options.classForZoom[t]=r;l._map.getZoom()==t&&l._invalidateMarkers(),e()}function o(e,s){return{safeZone:s.safeZone,x:e._positions[t].x+s.markerOffset[0],y:e._positions[t].y+s.markerOffset[1],height:s.size[1],width:s.size[0]}}var r,a,n,h=this.options,l=this,c=this._getPixelBoundsForZoom(t);for(r=0;r<h.levels.length;r++)this._markers[r]=[];var u=new L.Util.Quadtree(c);for(a=h.levels[0],r=0;r<this._priorityMarkers.length;r++)n=this._prepareMarker(r),this._markers[a].push(n),u.insert(o(n,a));var _,m=[],f=this._otherMarkers.slice();L.Util.UnblockingFor(s,h.levels.length,i)},_getPixelBoundsForZoom:function(t){var e,s=Number.MAX_VALUE,i=Number.MAX_VALUE,o=0,r=0;return this.eachLayer(function(a){e=a._positions[t],s=Math.min(s,e.x),i=Math.min(i,e.y),o=Math.max(o,e.x),r=Math.max(r,e.y)}),{x:s,y:i,width:o-s,height:r-i}},_validateGroup:function(t,e){if(0==e.length)return!0;var s,i=this.options;for(s=0;s<e.length;s++)if(!i.checkMarkersIntersection(t,e[s]))return!1;return!0},_invalidateMarkers:function(){var t,e=this._map.getZoom();this.eachLayer(function(s){t=s.options.classForZoom[e],t&&s.options.state!=t&&(s.options.state&&L.DomUtil.removeClass(s._icon,s.options.state),L.DomUtil.addClass(s._icon,t),s.options.state=t)},this)},_zoomStart:function(){this._map.getPanes().markerPane.style.display="none"},_zoomEnd:function(){this._invalidateMarkers(),this._map.getPanes().markerPane.style.display="block"},addLayer:function(t){return this._addLayer(t),this._map&&(this._prepareMarker(t),this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},addLayers:function(t){var e;for(e=0;e<t.length;e++)this._addLayer(t[e]);return this._map&&(this.eachLayer(this._prepareMarker,this),this._calculateMarkersClassForEachZoom()),this},_removeLayer:function(t){var e=this._layers.length;return L.LayerGroup.prototype.removeLayer.call(this,t),e-this._layers.length!=0},removeLayer:function(t){return this._removeLayer(t)&&(this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},onAdd:function(t){this._map=t,this._maxZoom=this._map.getMaxZoom(),t.on("zoomstart",this._zoomStart,this),t.on("zoomend",this._zoomEnd,this),this.eachLayer(this._prepareMarker,this),this._calculateMarkersClassForEachZoom(),L.LayerGroup.prototype.onAdd.call(this,t)},onRemove:function(t){this._map&&(t.off("zoomstart",this._zoomStart,this),t.off("zoomend",this._zoomEnd,this),L.LayerGroup.prototype.onRemove.call(this,t),this.eachLayer(function(t){t.options.state=""}),this._map=null)},clearLayers:function(){var t;for(t in this._layers)this._removeLayer(this._layers[t]);for(this._markers={},t=0;t<this.options.levels.length;t++)this._markers[t]=[];return this._priorityMarkers=[],this._otherMarkers=[],this}}),L.markerGeneralizeGroup=function(t){return new L.MarkerGeneralizeGroup(t)},L.Util.UnblockingFor=function(t,e,s){function i(e){setTimeout(function(){t(e,o)},0)}function o(){r++,e>r?i(r):s()}s=s||function(){};var r=0;i(r)};