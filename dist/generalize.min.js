!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,i.rbush=t()}}(function(){return function t(i,e,r){function n(s,o){if(!e[s]){if(!i[s]){var h="function"==typeof require&&require;if(!o&&h)return h(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var m=e[s]={exports:{}};i[s][0].call(m.exports,function(t){var e=i[s][1][t];return n(e?e:t)},m,m.exports,t,i,e,r)}return e[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,i,e){"use strict";function r(t,i){return this instanceof r?(this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&this._initFormat(i),void this.clear()):new r(t,i)}function n(t,i,e){if(!e)return i.indexOf(t);for(var r=0;r<i.length;r++)if(e(t,i[r]))return r;return-1}function a(t,i){s(t,0,t.children.length,i,t)}function s(t,i,e,r,n){n||(n=d(null)),n.minX=1/0,n.minY=1/0,n.maxX=-(1/0),n.maxY=-(1/0);for(var a,s=i;s<e;s++)a=t.children[s],o(n,t.leaf?r(a):a);return n}function o(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function h(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function m(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function c(t,i){return(Math.max(i.maxX,t.maxX)-Math.min(i.minX,t.minX))*(Math.max(i.maxY,t.maxY)-Math.min(i.minY,t.minY))}function f(t,i){var e=Math.max(t.minX,i.minX),r=Math.max(t.minY,i.minY),n=Math.min(t.maxX,i.maxX),a=Math.min(t.maxY,i.maxY);return Math.max(0,n-e)*Math.max(0,a-r)}function _(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function p(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function d(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-(1/0),maxY:-(1/0)}}function M(t,i,e,r,n){for(var a,s=[i,e];s.length;)e=s.pop(),i=s.pop(),e-i<=r||(a=i+Math.ceil((e-i)/r/2)*r,v(t,a,i,e,n),s.push(i,a,a,e))}i.exports=r;var v=t("quickselect");L.Util.rbush=r,r.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,e=[],r=this.toBBox;if(!p(t,i))return e;for(var n,a,s,o,h=[];i;){for(n=0,a=i.children.length;n<a;n++)s=i.children[n],o=i.leaf?r(s):s,p(t,o)&&(i.leaf?e.push(s):_(t,o)?this._all(s,e):h.push(s));i=h.pop()}return e},collides:function(t){var i=this.data,e=this.toBBox;if(!p(t,i))return!1;for(var r,n,a,s,o=[];i;){for(r=0,n=i.children.length;r<n;r++)if(a=i.children[r],s=i.leaf?e(a):a,p(t,s)){if(i.leaf||_(t,s))return!0;o.push(a)}i=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,e=t.length;i<e;i++)this.insert(t[i]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=d([]),this},remove:function(t,i){if(!t)return this;for(var e,r,a,s,o=this.data,h=this.toBBox(t),l=[],m=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],e=m.pop(),s=!0),o.leaf&&(a=n(t,o.children,i),a!==-1))return o.children.splice(a,1),l.push(o),this._condense(l),this;s||o.leaf||!_(o,h)?r?(e++,o=r.children[e],s=!1):o=null:(l.push(o),m.push(e),e=0,r=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:h,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var e=[];t;)t.leaf?i.push.apply(i,t.children):e.push.apply(e,t.children),t=e.pop();return i},_build:function(t,i,e,r){var n,s=e-i+1,o=this._maxEntries;if(s<=o)return n=d(t.slice(i,e+1)),a(n,this.toBBox),n;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),n=d([]),n.leaf=!1,n.height=r;var h,l,m,u,c=Math.ceil(s/o),f=c*Math.ceil(Math.sqrt(o));for(M(t,i,e,f,this.compareMinX),h=i;h<=e;h+=f)for(m=Math.min(h+f-1,e),M(t,h,m,c,this.compareMinY),l=h;l<=m;l+=c)u=Math.min(l+c-1,m),n.children.push(this._build(t,l,u,r-1));return a(n,this.toBBox),n},_chooseSubtree:function(t,i,e,r){for(var n,a,s,o,h,l,u,f;;){if(r.push(i),i.leaf||r.length-1===e)break;for(u=f=1/0,n=0,a=i.children.length;n<a;n++)s=i.children[n],h=m(s),l=c(t,s)-h,l<f?(f=l,u=h<u?h:u,o=s):l===f&&h<u&&(u=h,o=s);i=o||i.children[0]}return i},_insert:function(t,i,e){var r=this.toBBox,n=e?t:r(t),a=[],s=this._chooseSubtree(n,this.data,i,a);for(s.children.push(t),o(s,n);i>=0&&a[i].children.length>this._maxEntries;)this._split(a,i),i--;this._adjustParentBBoxes(n,a,i)},_split:function(t,i){var e=t[i],r=e.children.length,n=this._minEntries;this._chooseSplitAxis(e,n,r);var s=this._chooseSplitIndex(e,n,r),o=d(e.children.splice(s,e.children.length-s));o.height=e.height,o.leaf=e.leaf,a(e,this.toBBox),a(o,this.toBBox),i?t[i-1].children.push(o):this._splitRoot(e,o)},_splitRoot:function(t,i){this.data=d([t,i]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,e){var r,n,a,o,h,l,u,c;for(l=u=1/0,r=i;r<=e-i;r++)n=s(t,0,r,this.toBBox),a=s(t,r,e,this.toBBox),o=f(n,a),h=m(n)+m(a),o<l?(l=o,c=r,u=h<u?h:u):o===l&&h<u&&(u=h,c=r);return c},_chooseSplitAxis:function(t,i,e){var r=t.leaf?this.compareMinX:h,n=t.leaf?this.compareMinY:l,a=this._allDistMargin(t,i,e,r),s=this._allDistMargin(t,i,e,n);a<s&&t.children.sort(r)},_allDistMargin:function(t,i,e,r){t.children.sort(r);var n,a,h=this.toBBox,l=s(t,0,i,h),m=s(t,e-i,e,h),c=u(l)+u(m);for(n=i;n<e-i;n++)a=t.children[n],o(l,t.leaf?h(a):a),c+=u(l);for(n=e-i-1;n>=i;n--)a=t.children[n],o(m,t.leaf?h(a):a),c+=u(m);return c},_adjustParentBBoxes:function(t,i,e){for(var r=e;r>=0;r--)o(i[r],t)},_condense:function(t){for(var i,e=t.length-1;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():a(t[e],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},{quickselect:2}],2:[function(t,i,e){"use strict";function r(t,i,e,a,s){for(;a>e;){if(a-e>600){var o=a-e+1,h=i-e+1,l=Math.log(o),m=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*m*(o-m)/o)*(h-o/2<0?-1:1),c=Math.max(e,Math.floor(i-h*m/o+u)),f=Math.min(a,Math.floor(i+(o-h)*m/o+u));r(t,i,c,f,s)}var _=t[i],p=e,d=a;for(n(t,e,i),s(t[a],_)>0&&n(t,e,a);p<d;){for(n(t,p,d),p++,d--;s(t[p],_)<0;)p++;for(;s(t[d],_)>0;)d--}0===s(t[e],_)?n(t,e,d):(d++,n(t,d,a)),d<=i&&(e=d+1),i<=d&&(a=d-1)}}function n(t,i,e){var r=t[i];t[i]=t[e],t[e]=r}i.exports=r},{}]},{},[1])(1)}),L.MarkerClassList=function(t){this._classList={},this._marker=t},L.Util.extend(L.MarkerClassList.prototype,{add:function(t){return this._classList[t]=1,this._marker._icon&&L.DomUtil.addClass(this._marker._icon,t),this},remove:function(t){return delete this._classList[t],this._marker._icon&&L.DomUtil.removeClass(this._marker._icon,t),this},contains:function(t){return!!this._classList[t]},clear:function(){if(this._marker._icon)for(var t in this._classList)L.DomUtil.removeClass(this._marker._icon,t);this._classList={}},toString:function(){if(Object.keys)return Object.keys(this._classList).join(" ");var t="";for(var i in this._classList)t+=i+" "},_addClasses:function(){if(this._marker._icon)for(var t in this._classList)L.DomUtil.addClass(this._marker._icon,t)}}),L.markerClassList=function(t){return new L.MarkerClassList(t)},L.MarkerEx=L.Marker.extend({_extended:!0,onAdd:function(t){L.Marker.prototype.onAdd.apply(this,arguments),this._immunityLevel==this.IMMUNITY.NO_DELETE&&(this._icon.style.display="block"),this.classes._addClasses()},getEvents:function(){return this._zoomAnimated=!1,L.Marker.prototype.getEvents.apply(this,arguments)},onBeforeRemove:function(){return this._immunityLevel!=this.IMMUNITY.NO_HIDE&&(this._immunityLevel!=this.IMMUNITY.NO_DELETE||(this._icon.style.display="none",!1))},initialize:function(){L.Marker.prototype.initialize.apply(this,arguments),this.classes=L.markerClassList(this)},IMMUNITY:{NONE:0,NO_DELETE:1,NO_HIDE:2},_immunityLevel:null,immunifyForDeletion:function(){return this._immunityLevel=this.IMMUNITY.NO_DELETE,this},immunifyForHide:function(){return this._immunityLevel=this.IMMUNITY.NO_HIDE,this},revokeImmunity:function(){return this._immunityLevel=this.IMMUNITY.NONE,this}}),L.markerEx=function(t,i){return new L.MarkerEx(t,i)},L.MarkerGeneralizeGroup=L.FeatureGroup.extend({options:{levels:[{margin:30,safeZone:20,size:[25,40],offset:[12.5,40],className:"_pin"},{safeZone:5,size:[6,6],className:"_bullet"},{safeZone:0,className:"_hidden"}],viewportHideOffset:1,checkMarkersIntersection:function(t,i){var e=Math.max(t.safeZone,i.margin);return Math.abs(t.markerX-i.markerX)>e+t.markerWidth/2+i.markerWidth/2||Math.abs(t.markerY-i.markerY)>e+t.markerHeight/2+i.markerHeight/2},checkMarkerMinimumLevel:function(){return 0},pane:"markerPane"},initialize:function(t){L.Util.setOptions(this,t),this._layers={},this._priorityMarkers=[],this._otherMarkers=[],this._calculationBusy=!1,this._calculationQueued=!1,this._zoomReady={},this.setMaxZoom(t.maxZoom),this.setMinZoom(t.minZoom),this.on("invalidationFinish",function(){this.getPane().style.display="block"})},setMaxZoom:function(t){!isNaN(t)&&t<=19&&(this._maxZoom=t)},setMinZoom:function(t){if(!isNaN(t)&&t>=0){if(t>this._getMaxZoom())throw new Error("Min zoom must be smaller than max zoom");this._minZoom=t}},_getMaxZoom:function(){return isNaN(this._maxZoom)?this._map.getMaxZoom():this._maxZoom},_getMinZoom:function(){return isNaN(this._minZoom)?this._map.getMinZoom():this._minZoom},_getLevels:function(t){var i,e=this.options;return i="function"==typeof e.levels?e.levels(this._map,t):e.levels,this._prepareLevels(i)},_prepareLevels:function(t){var i,e,r;for(i=0;i<t.length;i++)for(r=t[i],r.index=i,r.markerOffset=[],r.markerDistance=[],r.size||(r.size=[0,0]),r.offset||(r.offset=[r.size[0]/2,r.size[1]/2]),e=0;e<2;e++)r.markerOffset[e]=r.size[e]/2-r.offset[e];return t},_addLayer:function(t){t._positions={},t.showAlways?this._priorityMarkers.push(t):this._otherMarkers.push(t);var i=this._map;i&&(this._map=null),L.LayerGroup.prototype.addLayer.call(this,t),i&&(this._map=i)},_prepareMarker:function(t){for(var i=this._getMaxZoom(),e=this._getMinZoom();i>=e;i--)this._setMarkerPosition(t,i)},_setMarkerPosition:function(t,i){t._positions[i]=this._map.project(t.getLatLng(),i),t.options.classForZoom=t.options.classForZoom||[],t.options.classForZoom[i]="HIDDEN"},_calculateMarkersClassForEachZoom:function(){var t=this;if(this._calculationBusy)return void(this._calculationQueued=!0);this._calculationBusy=!0,this._zoomReady={};for(var i=this._map.getZoom(),e=this._getMaxZoom(),r=[],n=this._getMinZoom();n<=e;n++)n!=i&&r.push(n);r.sort(function(t,e){return Math.abs(i-t)-Math.abs(i-e)}),this._calculateMarkersClassForZoom(i,function(){L.Util.UnblockingFor(function(i,e){var n=r[i];t._calculateMarkersClassForZoom(n,e)},r.length,function(){t._calculationBusy=!1,t.fireEvent("calculationFinish"),t._calculationQueued&&(t._calculationQueued=!1,t._calculateMarkersClassForEachZoom())})})},_calculateMarkersClassForZoom:function(t,i){function e(i,e){var n=[],s=_.length;if(0==l[i].size[0]&&0==l[i].size[1])return void e();for(var h=0;h<s;h++){var c=_[h];if(o=r(c,i),m.options.checkMarkerMinimumLevel(c)<=i){var f=a(c,o);u.collides(f)?n.push(c):(u.insert(f),c.options.classForZoom[t]=o.className)}else n.push(c)}_=n.slice(),e()}function r(t,i){var e=t.options.type;if(!e)return l[i];for(var r=i;r<=l.length;r++){var n=l[r].type;if(!n||n==e)return l[r]}}function n(){m._zoomReady[t]=!0,m._map.getZoom()==t&&m._invalidateMarkers(),i()}function a(i,e){var r=e.safeZone||0,n=e.margin||0,a=Math.max(r,n);i._positions[t]||m._setMarkerPosition(i,t);var s=i._positions[t].x-e.offset[0]-a,o=i._positions[t].y-e.offset[1]-a,h=e.size[0]+2*a,l=e.size[1]+2*a,u={minX:s,minY:o,maxX:s+h,maxY:o+l};return u.levelIndex=e.index,u.marker=i,u.safeZone=r,u.margin=n,u.markerX=i._positions[t].x+e.markerOffset[0],u.markerY=i._positions[t].y+e.markerOffset[1],u.markerHeight=e.size[1],u.markerWidth=e.size[0],u}var s,o,h,l=this._getLevels(t),m=this,u=L.Util.rbush(),c=[];for(s=0;s<this._priorityMarkers.length;s++)h=this._prepareMarker(this._priorityMarkers[s]),o=r(h,0),c.push(a(h,o));u.load(c);var f,_=[];for(s=0;s<this._otherMarkers.length;s++)h=this._otherMarkers[s],f=h.data&&h.data.zoomLevelsRange,(!f||t>=f[0]&&t<=f[1])&&_.push(h);L.Util.UnblockingFor(e,l.length,n)},_getPixelBoundsForZoom:function(t){var i,e=Number.MAX_VALUE,r=Number.MAX_VALUE,n=0,a=0;return this.eachLayer(function(s){s._positions[t]||that._setMarkerPosition(s,t),i=s._positions[t],e=Math.min(e,i.x),r=Math.min(r,i.y),n=Math.max(n,i.x),a=Math.max(a,i.y)}),{x:e,y:r,width:n-e,height:a-r}},_invalidateMarkers:function(){var t=this._map.getZoom();if(this._zoomReady[t]){var i=this._map.getPixelBounds(),e=(i.max.x-i.min.x)*this.options.viewportHideOffset,r=(i.max.y-i.min.y)*this.options.viewportHideOffset;i.min._subtract({x:e,y:r}),i.max._add({x:e,y:r}),this.eachLayer(function(e){var r=e.options.classForZoom[t],n=e._positions[t],a=e.options.state;e._immunityLevel&&(e._map||this._map.addLayer(e),a!=r&&"HIDDEN"!=r&&L.DomUtil.addClass(e._icon,r)),i.contains(n)?"HIDDEN"!=r&&a!=r&&(e._map||this._map.addLayer(e),a!=r&&(a&&"HIDDEN"!=a&&L.DomUtil.removeClass(e._icon,a),L.DomUtil.addClass(e._icon,r))):r="HIDDEN","HIDDEN"==r&&(!e.onBeforeRemove||e.onBeforeRemove&&e.onBeforeRemove())&&this._map.removeLayer(e),e.options.state=r},this),this.fireEvent("invalidationFinish")}},_zoomStart:function(){this.getPane().style.display="none"},addLayer:function(t){return this._addLayer(t),this._map&&!t._immunityLevel&&(this._prepareMarker(t),this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},addLayers:function(t){var i;for(i=0;i<t.length;i++)this._addLayer(t[i]);return this._map&&(this.eachLayer(this._prepareMarker,this),setTimeout(this._calculateMarkersClassForEachZoom.bind(this),0)),this},_removeLayer:function(t){var i,e=this._layers.length;return(i=this._priorityMarkers.indexOf(t))!=-1?this._priorityMarkers.splice(i,1):(i=this._otherMarkers.indexOf(t))!=-1&&this._otherMarkers.splice(i,1),L.LayerGroup.prototype.removeLayer.call(this,t),e-this._layers.length!=0},removeLayer:function(t){return this._removeLayer(t)&&(this._calculateMarkersClassForEachZoom(),this._invalidateMarkers()),this},getEvents:function(){var t={zoomstart:this._zoomStart,moveend:this._invalidateMarkers};return t},onAdd:function(t){this._map=t,this.getLayers().length&&(this.eachLayer(this._prepareMarker,this),setTimeout(this._calculateMarkersClassForEachZoom.bind(this),0))},onRemove:function(t){this._map&&(L.LayerGroup.prototype.onRemove.call(this,t),this.eachLayer(function(t){t.options.state="HIDDEN"}),this._map=null)},clearLayers:function(){var t;for(t in this._layers)this._removeLayer(this._layers[t]);return this._priorityMarkers=[],this._otherMarkers=[],this}}),L.markerGeneralizeGroup=function(t){return new L.MarkerGeneralizeGroup(t)},L.Util.UnblockingFor=function(t,i,e){function r(i){setTimeout(function(){t(i,n)},0)}function n(){a++,a<i?r(a):e()}e=e||function(){};var a=0;r(a)};