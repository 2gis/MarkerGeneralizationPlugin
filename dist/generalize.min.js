!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MarkerGeneralizationPlugin=t():e.MarkerGeneralizationPlugin=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=0)}([function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(){L.markerEx=function(e,t){return new a.default(e,t)},L.markerGeneralizeGroup=function(e){return new u.default(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var o=r(1),a=i(o),s=r(3),u=i(s)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(2);!function(e){e&&e.__esModule}(i);t.default=L.Marker.extend({_extended:!0,onAdd:function(){L.Marker.prototype.onAdd.apply(this,arguments),this._immunityLevel==this.IMMUNITY.NO_DELETE&&(this._icon.style.display="block"),this.classes._addClasses()},getEvents:function(){return this._zoomAnimated=!1,L.Marker.prototype.getEvents.apply(this,arguments)},onBeforeRemove:function(){return this._immunityLevel!=this.IMMUNITY.NO_HIDE&&(this._immunityLevel!=this.IMMUNITY.NO_DELETE||(this._icon.style.display="none",!1))},initialize:function(){L.Marker.prototype.initialize.apply(this,arguments),this.classes=L.markerClassList(this)},IMMUNITY:{NONE:0,NO_DELETE:1,NO_HIDE:2},_immunityLevel:null,immunifyForDeletion:function(){return this._immunityLevel=this.IMMUNITY.NO_DELETE,this},immunifyForHide:function(){return this._immunityLevel=this.IMMUNITY.NO_HIDE,this},revokeImmunity:function(){return this._immunityLevel=this.IMMUNITY.NONE,this}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),L.MarkerClassList=function(e){this._classList={},this._marker=e},L.Util.extend(L.MarkerClassList.prototype,{add:function(e){return this._classList[e]=1,this._marker._icon&&L.DomUtil.addClass(this._marker._icon,e),this},remove:function(e){return delete this._classList[e],this._marker._icon&&L.DomUtil.removeClass(this._marker._icon,e),this},contains:function(e){return!!this._classList[e]},clear:function(){if(this._marker._icon)for(var e in this._classList)L.DomUtil.removeClass(this._marker._icon,e);this._classList={}},toString:function(){if(Object.keys)return Object.keys(this._classList).join(" ");var e="";for(var t in this._classList)e+=t+" ";return e},_addClasses:function(){if(this._marker._icon)for(var e in this._classList)L.DomUtil.addClass(this._marker._icon,e)}}),L.markerClassList=function(e){return new L.MarkerClassList(e)},t.default=L.MarkerClassList},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),n=r(6),o=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=L.FeatureGroup.extend({options:{levels:[{margin:30,safeZone:20,size:[25,40],offset:[.5,1],className:"_pin"},{safeZone:5,size:[6,6],className:"_bullet"},{safeZone:0,className:"_hidden"}],bufferPart:.5,checkMarkerMinimumLevel:function(){return 0},pane:"markerPane"},initialize:function(e){L.Util.setOptions(this,e),this._generalizer=new i.General,this._layers={},this._priorityMarkers=[],this._otherMarkers=[],this.setMaxZoom(e.maxZoom),this.setMinZoom(e.minZoom),this._initZooms()},setMaxZoom:function(e){!isNaN(e)&&e<=19&&(this._maxZoom=e)},setMinZoom:function(e){if(!isNaN(e)&&e>=0){if(e>this._getMaxZoom())throw new Error("Min zoom must be smaller than max zoom");this._minZoom=e}},_getMaxZoom:function(){return isNaN(this._maxZoom)?this._map?this._map.getMaxZoom():18:this._maxZoom},_getMinZoom:function(){return isNaN(this._minZoom)?this._map?this._map.getMinZoom():0:this._minZoom},_initZooms:function(){this._zoomStat={};for(var e=this._getMaxZoom(),t=this._getMinZoom();t<=e;++t)this._zoomStat[t]={ready:!1,pending:!1,markers:null,bounds:{minX:0,minY:0,maxX:0,maxY:0}}},_flushMarkersCache:function(){for(var e=this._getMaxZoom(),t=this._getMinZoom();t<=e;++t)this._zoomStat[t].markers=null},_getLevels:function(e){var t,r=this.options;return t="function"==typeof r.levels?r.levels(this._map,e):r.levels,this._prepareLevels((0,o.default)(t))},_prepareLevels:function(e){for(var t=window.devicePixelRatio,r=0;r<e.length;r++){var i=e[r];i.index=r,i.size||(i.size=[0,0]),i.size[0]*=t,i.size[1]*=t,i.offset||(i.offset=[.5,.5]),i.margin||(i.margin=0),i.margin*=t,i.safeZone||(i.safeZone=0),i.safeZone*=t,i.degradation||(i.degradation=0),i.degradation*=t}return e},_addLayer:function(e){e.addEventParent(this),e.showAlways?this._priorityMarkers.push(e):this._otherMarkers.push(e);var t=this._map;t&&(this._map=null),L.LayerGroup.prototype.addLayer.call(this,e),t&&(this._map=t)},_getMapCenter:function(e){var t=this._map._getCenterLayerPoint(),r=t.add(this._map.getPixelOrigin());return this._map.unproject(r,e)},_getScreenBounds:function(e,t){if(!this._map)return{minX:0,minY:0,maxX:0,maxY:0};var r=window.devicePixelRatio,i=this._map._getTopLeftPoint(e,t),n=this._map.getSize();return{minX:i.x*r,minY:i.y*r,maxX:(i.x+n.x)*r,maxY:(i.y+n.y)*r}},_getBounds:function(e,t){var r=this._getScreenBounds(e,t);return{minX:r.minX-(r.maxX-r.minX)*this.options.bufferPart,minY:r.minY-(r.maxY-r.minY)*this.options.bufferPart,maxX:r.maxX+(r.maxX-r.minX)*this.options.bufferPart,maxY:r.maxY+(r.maxY-r.minY)*this.options.bufferPart}},_getLatLngBounds:function(e,t,r){var i=new L.Bounds(L.point(e.minX,e.minY),L.point(e.maxX,e.maxY)),n=this._map.unproject(i.getBottomLeft(),r),o=this._map.unproject(i.getTopRight(),r);return new L.LatLngBounds(n,o)},_prepareMarker:function(e){for(var t=this._getMinZoom(),r=this._getMaxZoom();r>=t;--r)e.options.classForZoom=e.options.classForZoom||[],e.options.classForZoom[r]="HIDDEN"},_prepareMarkersForGeneralization:function(e){var t=window.devicePixelRatio;if(this._zoomStat[e].markers){for(var r=0;r<this._zoomStat[e].markers.length;++r){var i=this._map.project(this._zoomStat[e].markers[r]._latlng,e);this._zoomStat[e].markers[r].pixelPosition=[i.x*t,i.y*t]}return this._zoomStat[e].markers}for(var n=new Array(this._otherMarkers.length),o=0;o<this._otherMarkers.length;++o){var a=this._map.project(this._otherMarkers[o]._latlng,e),s={_latlng:this._otherMarkers[o]._latlng,groupIndex:this.options.checkMarkerMinimumLevel(this._otherMarkers[o]),iconIndex:-1,pixelPosition:[a.x*t,a.y*t]};n[o]=s}return n},_calculateMarkersClassesIfNeeded:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._map.getZoom();if(this._map){if(!this._zoomStat[e].ready&&!this._zoomStat[e].pending)return void this._calculateMarkersClasses(e);var t=this._getMapCenter(),r=this._zoomStat[e].bounds,i=this._getScreenBounds(t,e),n=this._getLatLngBounds(i,t,e);if(!r.contains(n))return void this._calculateMarkersClasses(e);this._invalidateMarkers()}},_calculateMarkersClasses:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._map.getZoom();if(this._map){var r=this._getLevels(t),i=this._getMapCenter(),n=this._getBounds(i,t),o=r.map(function(e){return{iconIndex:e.index,safeZone:e.safeZone,margin:e.margin,degradation:e.degradation}}),a=r.map(function(e){return{size:e.size,anchor:e.offset}}),s=this._prepareMarkersForGeneralization(t);return this._zoomStat[t]={ready:!1,pending:!0,bounds:this._getLatLngBounds(n,i,t),markers:s},this._generalizer.generalize(n,o,a,s).then(function(){for(var i=0;i<s.length;++i){var n=e._otherMarkers[i],o=s[i].iconIndex;n.options.classForZoom[t]=-1==o?"HIDDEN":r[o].className}for(var a=0;a<e._priorityMarkers.length;++a){var u=e._priorityMarkers[a],c=e.options.checkMarkerMinimumLevel(u);u.options.classForZoom[t]=-1==c?"HIDDEN":r[c].className}e._zoomStat[t].ready=!0,e._zoomStat[t].pending=!1,e._map.getZoom()==t&&e._invalidateMarkers()}).catch(function(){e.fireEvent("generalizationError")})}},_invalidateMarkers:function(){var e=this._map.getZoom();if(this._zoomStat[e].ready){for(var t in this._layers){var r=this._layers[t],i=r.options.classForZoom[e],n=r.options.state;if(r._immunityLevel&&(r._map||this._map.addLayer(r),n!=i&&"HIDDEN"!=i&&L.DomUtil.addClass(r._icon,i)),"HIDDEN"!=i&&n!=i&&(r._map||this._map.addLayer(r),n!=i&&(n&&"HIDDEN"!=n&&L.DomUtil.removeClass(r._icon,n),L.DomUtil.addClass(r._icon,i))),"HIDDEN"==i){(!r.onBeforeRemove||r.onBeforeRemove())&&this._map.removeLayer(r)}r.options.state=i}this.getPane().style.display="block",this.fireEvent("invalidationFinish")}},_zoomStart:function(){this._zoomStat[this._map.getZoom()]={ready:!1,pending:!1,bounds:this._map.getBounds(),markers:null},this.getPane().style.display="none"},addLayer:function(e){return this._addLayer(e),this._map&&!e._immunityLevel&&(this._flushMarkersCache(),this._prepareMarker(e),this._calculateMarkersClasses(),this._invalidateMarkers()),this},addLayers:function(e){var t;for(t=0;t<e.length;t++)this._addLayer(e[t]);return this._map&&(this._flushMarkersCache(),this.eachLayer(this._prepareMarker,this),setTimeout(this._calculateMarkersClasses.bind(this),0)),this},_removeLayer:function(e){var t,r=this._layers.length;return-1!=(t=this._priorityMarkers.indexOf(e))?this._priorityMarkers.splice(t,1):-1!=(t=this._otherMarkers.indexOf(e))&&this._otherMarkers.splice(t,1),L.LayerGroup.prototype.removeLayer.call(this,e),r-this._layers.length!=0},removeLayer:function(e){return this._removeLayer(e)&&(this._flushMarkersCache(),this._calculateMarkersClasses(),this._invalidateMarkers()),this},getEvents:function(){var e=this;return{zoomstart:this._zoomStart,zoomend:function(){return e._calculateMarkersClassesIfNeeded()},moveend:function(){return e._calculateMarkersClassesIfNeeded()}}},onAdd:function(e){this._map=e,this._initZooms(),this.getLayers().length&&(this.eachLayer(this._prepareMarker,this),setTimeout(this._calculateMarkersClasses.bind(this),0))},onRemove:function(e){if(this._map){L.LayerGroup.prototype.onRemove.call(this,e);for(var t in this._layers){this._layers[t].options.state="HIDDEN"}this._flushMarkersCache(),this._map=null}},clearLayers:function(){for(var e in this._layers)L.LayerGroup.prototype.removeLayer.call(this,this._layers[e]);return this._priorityMarkers=[],this._otherMarkers=[],this._flushMarkersCache(),this}})},function(e,t,r){"use strict";(function(e){var r,i,n,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(a,s){"object"==o(t)&&"object"==o(e)?e.exports=s():(i=[],r=s,void 0!==(n="function"==typeof r?r.apply(t,i):r)&&(e.exports=n))}(0,function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=1)}([function(e,t,r){function i(e,t){for(var r=0,i=0;r<t.length;r++,i+=a){var n=t[r],s=n.iconIndex,u=n.prevGroupIndex;e[i+o.pixelPositionX]=n.pixelPosition[0],e[i+o.pixelPositionY]=n.pixelPosition[1],e[i+o.groupIndex]=n.groupIndex,e[i+o.iconIndex]=void 0!==s?s:NaN,e[i+o.prevGroupIndex]=void 0!==u?u:NaN}}function n(e,t){for(var r=0,i=0;r<e.length;r++,i+=a){var n=t[i+o.iconIndex],s=t[i+o.prevGroupIndex];e[r].iconIndex=n!==n?void 0:n,e[r].prevGroupIndex=s!==s?void 0:s}}r.d(t,"a",function(){return o}),r.d(t,"c",function(){return a}),t.b=i,t.d=n;var o={pixelPositionX:0,pixelPositionY:1,groupIndex:2,iconIndex:3,prevGroupIndex:4},a=Object.keys(o).length},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=r(2);r.d(t,"General",function(){return i.a})},function(e,t,r){r.d(t,"a",function(){return a});var i=r(0),n=r(3),o=r.n(n),a=function(){function e(){var e=this;this.worker=o()(4),this.queue=[],this.currentJob=void 0,this.markerArray=new Float32Array(1e3*i.c),this.worker.onmessage=function(t){if(void 0!==e.currentJob){var r=e.currentJob,n=r.markers,o=r.resolve;Object(i.d)(n,t.data),e.markerArray=t.data,e.currentJob=void 0,e.dequeue(),o()}}}return e.prototype.generalize=function(e,t,r,i){var n=this,o={bounds:e,priorityGroups:t,sprites:r};return new Promise(function(e){n.queue.push({message:o,markers:i,resolve:e}),n.dequeue()})},e.prototype.clear=function(){this.queue=[]},e.prototype.pack=function(e){e.length*i.c>this.markerArray.length&&(this.markerArray=new Float32Array(e.length*i.c)),Object(i.b)(this.markerArray,e)},e.prototype.dequeue=function(){if(void 0===this.currentJob){var e=this.queue.shift();if(void 0!==e){this.pack(e.markers);var t=e.message;t.markers=this.markerArray,t.markerCount=e.markers.length,this.worker.postMessage(t,[t.markers.buffer]),this.currentJob=e}}},e}()},function(e,t,r){function i(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t.oe=function(e){throw console.error(e),e};var i=t(t.s=ENTRY_MODULE);return i.default||i}function n(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e){var t=[],r=e.toString(),i=r.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return t;for(var o,a=i[1],s=new RegExp("(\\\\n|\\W)"+n(a)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");o=s.exec(r);)t.push(o[3]);return t}function a(e,t){for(var r=[t],i=[],n={};r.length;){var a=r.pop();if(!n[a]&&e[a]){n[a]=!0,i.push(a);var s=o(e[a]);r=r.concat(s)}}return i}e.exports=function(e,t){t=t||{};var n=r.m,o=t.all?Object.keys(n):a(n,e),s="("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.map(function(e){return JSON.stringify(e)+": "+n[e].toString()}).join(",")+"})(self);",u=new window.Blob([s],{type:"text/javascript"});if(t.bare)return u;var c=window.URL||window.webkitURL||window.mozURL||window.msURL,l=c.createObjectURL(u),m=new window.Worker(l);return m.objectURL=l,m}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=r(5);t.default=function(e){e.onmessage=function(t){var r=t.data;Object(i.a)(r),e.postMessage(r.markers)}}},function(e,t,r){function i(e){for(var t=e.bounds,r=e.priorityGroups,i=e.sprites,h=e.markers,p=e.markerCount,d=1+(t.maxX-t.minX>>3)<<3,_=t.maxY-t.minY,v=d*_+8>>3,y=new Uint8Array(v),g=[],x=0;x<r.length;x++)g[x]=new Uint8Array(v);for(var x=0;x<p;x++){var k=x*c.c,M=h[k+c.a.prevGroupIndex];if(!a(M)){var L=h[k+c.a.pixelPositionX]-t.minX,b=h[k+c.a.pixelPositionY]-t.minY,I=r[M],w=I.iconIndex,N=I.margin,z=I.degradation,P=i[w];if(!P)continue;var Y=P.size,O=P.anchor;u(l,d,_,Y,O,L,b,0),s(l)?h[k+c.a.iconIndex]=-1:h[k+c.a.iconIndex]=w,u(m,d,_,Y,O,L,b,N),s(m)||o(y,d,m),u(f,d,_,Y,O,L,b,z),s(f)||o(g[M],d,f)}}for(var x=0;x<r.length;x++){var Z=r[x],j=Z.safeZone,w=Z.iconIndex,N=Z.margin,z=Z.degradation,P=i[w];if(P)for(var Y=P.size,O=P.anchor,E=0!==x?g[x-1]:void 0,X=x!==r.length-1?g[x]:void 0,C=0;C<p;C++){var k=C*c.c,D=h[k+c.a.groupIndex],M=h[k+c.a.prevGroupIndex],L=h[k+c.a.pixelPositionX]-t.minX,b=h[k+c.a.pixelPositionY]-t.minY;D>x||!a(M)||(u(m,d,_,Y,O,L,b,N),s(m)||D===x&&E&&n(E,d,m)||(u(l,d,_,Y,O,L,b,j),s(l)||n(y,d,l)||(u(f,d,_,Y,O,L,b,z),o(y,d,m),X&&o(X,d,f),h[k+c.a.iconIndex]=w,h[k+c.a.prevGroupIndex]=x)))}}}function n(e,t,r){for(var i=r.minX,n=r.minY,o=r.maxX,a=r.maxY,s=n;s<a;s++){var u=s*t+i>>3,c=s*t+o>>3,l=0;if(u===c)l=e[u]&255>>(7&i)&255<<8-(7&o);else{l=e[u]&255>>(7&i);for(var m=u+1;m<c;m++)l=e[m]|l;l=e[c]&255<<8-(7&o)|l}if(0!==l)return!0}return!1}function o(e,t,r){for(var i=r.minX,n=r.minY,o=r.maxX,a=r.maxY,s=n;s<a;s++){var u=s*t+i>>3,c=s*t+o>>3;if(u===c)e[u]=e[u]|255>>(7&i)&255<<8-(7&o);else{e[u]=e[u]|255>>(7&i);for(var l=u+1;l<c;l++)e[l]=255;e[c]=e[c]|255<<8-(7&o)}}}function a(e){return e!==e}function s(e){return e.minX===e.maxX||e.minY===e.maxY}function u(e,t,r,i,n,o,a,s){var u=o-i[0]*n[0]-s|0,c=a-i[1]*n[1]-s|0,l=o+i[0]*(1-n[0])+s|0,m=a+i[1]*(1-n[1])+s|0;e.minX=u>0?u<t?u:t:0,e.minY=c>0?c<r?c:r:0,e.maxX=l>0?l<t?l:t:0,e.maxY=m>0?m<r?m:r:0}t.a=i;var c=r(0),l={minX:0,minY:0,maxX:0,maxY:0},m={minX:0,minY:0,maxX:0,maxY:0},f={minX:0,minY:0,maxX:0,maxY:0}}])})}).call(t,r(5)(e))},function(e,t,r){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";e.exports=r(7).default},function(e,t,r){"use strict";function i(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,n=r.get(e);if(n)return n;if(Array.isArray(e)){var o=[];r.set(e,o);for(var a=0;a<e.length;a++)o[a]=i(e[a],t,r);return o}if(e instanceof Date)return new Date(e.valueOf());if(!(e instanceof Object))return e;var s={};r.set(e,s);for(var u=Object.keys(e),c=0;c<u.length;c++){s[t?t(u[c]):u[c]]=i(e[u[c]],t,r)}return s}function n(e){return function(t){return i(t,e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i,t.formatKeys=n,i.formatKeys=n}])});
//# sourceMappingURL=generalize.min.js.map